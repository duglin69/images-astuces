<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Alchimiste Master : Codex Supr√™me</title>
    <style>
        :root { --neon-cyan: #00f2ff; --neon-pink: #ff0055; --bg: #050508; }
        body { font-family: 'Inter', sans-serif; background: #010103; color: #e0e0e0; padding: 20px; line-height: 1.4; padding-top: 80px; }
        .container { max-width: 1300px; margin: auto; background: var(--bg); padding: 30px; border-radius: 20px; border: 1px solid #1a1a2e; box-shadow: 0 0 50px rgba(0,242,255,0.1); }
        h1 { color: var(--neon-cyan); text-align: center; text-transform: uppercase; letter-spacing: 3px; border-bottom: 1px solid #1a1a2e; padding-bottom: 15px; }
        h2 { color: var(--neon-pink); font-size: 0.8em; text-transform: uppercase; margin-top: 20px; border-left: 3px solid var(--neon-pink); padding-left: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .full-width { grid-column: 1 / -1; }
        label { display: block; margin-bottom: 5px; font-size: 0.7em; color: var(--neon-cyan); font-weight: 700; opacity: 0.8; }
        select, input { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #222; background: #0d0d14; color: #fff; font-size: 0.85em; box-sizing: border-box; }
        .palette-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-top: 10px; }
        .color-btn { cursor: pointer; border: 1px solid #333; border-radius: 4px; padding: 8px; font-size: 0.7em; font-weight: bold; text-align: center; color: #000; transition: 0.2s; }
        .style-row { display: grid; grid-template-columns: 2fr 1fr 2fr; gap: 8px; margin-bottom: 10px; }
        .weight-num { text-align: center; font-weight: bold; color: var(--neon-pink); background: #1a050d; }
        .output-box { background: #000; border: 1px solid var(--neon-cyan); padding: 20px; border-radius: 12px; margin-top: 20px; }
        #finalPrompt { display: block; font-family: 'Fira Code', monospace; font-size: 0.8em; color: #a5b4fc; white-space: pre-wrap; word-break: break-all; }
        button { cursor: pointer; padding: 15px; border: none; border-radius: 8px; font-weight: bold; text-transform: uppercase; margin-top: 10px; transition: 0.3s; }
        .btn-main { background: var(--neon-cyan); color: #000; width: 100%; font-size: 1.1em; }
        .btn-surprise { background: #9d00ff; color: #fff; width: 49%; display: inline-block; }
        .btn-reset { background: #333; color: #fff; width: 49%; display: inline-block; }
        .btn-copy { background: var(--neon-pink); color: white; width: 100%; }
        .custom-input { display: none; margin-top: 5px; border-color: var(--neon-cyan); }
        .boutique-custom-box { display: none; background: #0a0a15; border: 1px dashed var(--neon-cyan); padding: 15px; border-radius: 10px; margin-top: 10px; }
        .boutique-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .lexique { font-size: 0.7em; color: #666; display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 5px; margin-top: 10px; }
        .top-right { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 1000; }
        .btn-retour { display: inline-block; padding: 12px 20px; background: #007BFF; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; }
    </style>
</head>
<body>

<div class="top-right">
    <a href="index.html" class="btn-retour">üè† Accueil</a>
    <a href="repertoire/index.html" class="btn-retour">üìö R√©pertoire</a>
</div>

<div class="container">
    <h1>üåå ALCHIMISTE MASTER : CODEX SUPR√äME</h1>
    
    <div class="grid">
        <div>
            <h2>üë• Casting Principal</h2>
            <select id="char" onchange="toggleCustom(this)">
                <option value="none" selected disabled>-- Choisir Sujet --</option>
                <option value="Alice in Wonderland">Alice aux pays des Merveilles</option>
                <option value="Cleopatra">Cl√©op√¢tre</option>
                <option value="Albert Einstein">Albert Einstein</option>
                <option value="an Aztec warrior in traditional ceremonial regalia with a majestic feathered headdress">Guerrier Azt√®que (Traditionnel)</option>
                <option value="A handsome man">Un homme</option>
                <option value="A graceful woman in an elegant gown">Une femme √©l√©gante</option>
                <option value="A majestic celestial dragon">Un dragon c√©leste</option>
                <option value="A tiny glowing forest fairy">Une f√©e des bois</option>
                <option value="A rugged futuristic robot">Un robot futuriste</option>
                <option value="Audrey Hepburn, Goldorak, and Leonardo da Vinci">Hepburn, Goldorak & Vinci</option>
                <option value="Prince and Santa Claus">Prince & P√®re No√´l</option>
                <option value="Amy Winehouse, Elon Musk, and Jacques Chirac">Winehouse, Musk & Chirac</option>
                <option value="Salvador Dali, Charlie Chaplin, and Bruce Willis">Dali, Chaplin & Willis</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="char_custom" class="custom-input">

            <label style="margin-top:10px;">Attribut du Sujet</label>
            <select id="char_attr" onchange="toggleCustom(this)">
                <option value="none" selected>-- Aucun --</option>
                <option value="with vibrant paint emanating from the body">√âmanation de peinture</option>
                <option value="surrounded by mystical neon sparks">√âtincelles n√©on</option>
                <option value="dissolving into a cloud of colorful smoke">Dissolution en fum√©e</option>
                <option value="covered in glowing crystalline veins">Veines de cristal</option>
                <option value="dripping with liquid gold">Suintement d'or</option>
                <option value="wrapped in translucent silk ribbons">Rubans de soie</option>
                <option value="emanating cold blue mist">Brume bleue</option>
                <option value="turning into organic flower petals">P√©tales organiques</option>
                <option value="with yellow, blue, and green paint emanating from the body and changing the water color around">√âmanations tricolores (Azt√®que)</option>
                <option value="with pixelated wings of light">Ailes de pixels lumineuses</option>
                <option value="with a liquid mercury skin">Peau en mercure liquide</option>
                <option value="under a digital glitch effect">Effet de glitch num√©rique</option>
                <option value="with lava flowing through body cracks">Fissures de lave</option>
                <option value="surrounded by a prismatic rainbow aura">Aura prismatique</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="char_attr_custom" class="custom-input">
        </div>

        <div>
            <h2>ü§ù Compagnon & Duo</h2>
            <select id="companion" onchange="toggleCustom(this)">
                <option value="none" selected disabled>-- Choisir Compagnon --</option>
                <option value="none">Seul</option>
                <option value="with the Mad Hatter, the Cheshire Cat, the White Rabbit, and the Queen of Hearts">La clique d'Alice</option>
                <option value="with Albert Einstein">Albert Einstein</option>
                <option value="with Cleopatra">Cl√©op√¢tre</option>
                <option value="with a friendly alien creature">Un extraterrestre</option>
                <option value="with a mechanical tiger">Un tigre m√©canique</option>
                <option value="with a majestic phoenix">Un ph√©nix</option>
                <option value="with a pensive cybernetic robot">Un robot pensif</option>
                <option value="an Aztec warrior in traditional ceremonial regalia with a majestic feathered headdress">Guerrier Azt√®que (Traditionnel)</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="companion_custom" class="custom-input">

            <label style="margin-top:10px;">Attribut du Compagnon</label>
            <select id="comp_attr" onchange="toggleCustom(this)">
                <option value="none" selected>-- Aucun --</option>
                <option value="with vibrant paint emanating from the body">√âmanation de peinture</option>
                <option value="surrounded by mystical neon sparks">√âtincelles n√©on</option>
                <option value="dissolving into a cloud of colorful smoke">Dissolution en fum√©e</option>
                <option value="covered in glowing crystalline veins">Veines de cristal</option>
                <option value="dripping with liquid gold">Suintement d'or</option>
                <option value="wrapped in translucent silk ribbons">Rubans de soie</option>
                <option value="turning into organic flower petals">P√©tales organiques</option>
                <option value="with yellow, blue, and green paint emanating from the body and changing the water color around">√âmanations tricolores (Azt√®que)</option>
                <option value="with pixelated wings of light">Ailes de pixels lumineuses</option>
                <option value="with a liquid mercury skin">Peau en mercure liquide</option>
                <option value="surrounded by a prismatic rainbow aura">Aura prismatique</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="comp_attr_custom" class="custom-input">
        </div>

        <div class="full-width">
            <h2>üåà Palette Chromatique</h2>
            <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                <div>
                    <label>Couleur Libre</label>
                    <input type="color" id="colorPicker" value="#00f2ff" style="height: 50px; cursor: pointer;" onchange="updateColorText(this.value)">
                </div>
                <div style="flex: 1;">
                    <label>Harmonies de Ma√Ætre</label>
                    <div class="palette-grid">
                        <button class="color-btn" style="background:#e6b450;" onclick="setPalette('Ancient Gold and Black Obsidian')">Or & Obsidienne</button>
                        <button class="color-btn" style="background:linear-gradient(to right, #ff0055, #00f2ff);" onclick="setPalette('Vivid Neon Pink and Cyan')">Cyber N√©on</button>
                        <button class="color-btn" style="background:linear-gradient(to right, #ff0000, #ffff00, #0000ff);" onclick="setPalette('Primary Carnival Splashes')">Carnaval</button>
                        <button class="color-btn" style="background:#ffffff; border: 1px solid #ccc;" onclick="setPalette('Pure High-Key White and Pastel Softness')">High-Key</button>
                        <button class="color-btn" style="background:#1a1a1a; color:#fff;" onclick="setPalette('Deep Monochrome and Silver highlights')">Monochrome</button>
                    </div>
                </div>
            </div>
            <input type="text" id="color_text" placeholder="Description manuelle des couleurs..." style="margin-top: 15px;">
            <div style="margin-top: 10px; display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" id="target_color" style="width: 25px; height: 25px; cursor: pointer;">
                <label style="margin-bottom: 0; font-size: 0.9em; color: var(--neon-pink); font-weight: bold;">CIBLER UNIQUEMENT LE SUJET PRINCIPAL (Contraste)</label>
            </div>
        </div>

        <div>
            <h2>üé≠ Mise en Sc√®ne</h2>
            <label>Action</label>
            <select id="action" onchange="toggleCustom(this)">
                <option value="none" selected disabled>-- Choisir Action --</option>
                <option value="none">Statique</option>
                <option value="doing grocery shopping">Faisant ses courses</option>
                <option value="swimming in a giant cooking pot">Dans une casserole</option>
                <option value="skateboarding on the rings of Saturn">Skateboard sur Saturne</option>
                <option value="in a heated televised debate with the President">D√©bat t√©l√©vis√©</option>
                <option value="having a drink on a cafe terrace">Verre en terrasse</option>
                <option value="playing chess on a holographic board">Jouant aux √©checs</option>
                <option value="playing ping pong on a floating table">Jouant au ping-pong</option>
                <option value="flying on the back of a mechanical dragon">Volant sur un dragon</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="action_custom" class="custom-input">

            <label style="margin-top:10px;">√âclairage</label>
            <select id="lighting" onchange="toggleCustom(this)">
                <option value="none" selected disabled>-- Choisir √âclairage --</option>
                <option value="illuminated by divine heavenly light">Lumi√®re Divine</option>
                <option value="under a mystical silvery moonlight">Clair de Lune</option>
                <option value="with stroboscopic neon flashes">N√©ons Stroboscopiques</option>
                <option value="during the warm golden hour">Golden Hour</option>
                <option value="with eerie bioluminescent glow">Bioluminescence</option>
                <option value="with dramatic chiaroscuro shadows">Clair-obscur</option>
                <option value="in a soft cinematic morning mist">Brume Matinale</option>
                <option value="with gritty cyberpunk street lighting">Cyberpunk Lighting</option>
                <option value="with underwater shimmering caustics">Reflets Sous-marins</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="lighting_custom" class="custom-input">
        </div>

        <div>
            <h2>üé® Technique & Fusion</h2>
            <label>M√©dium & Outils</label>
            <select id="medium" onchange="toggleCustom(this)">
                <option value="none" selected disabled>-- Choisir M√©dium --</option>
                <option value="Alcohol Ink technique">Alcohol Ink</option>
                <option value="rough charcoal sketch">Fusain</option>
                <option value="delicate watercolor wash">Aquarelle</option>
                <option value="thick impasto oil painting">Peinture √† l'Huile</option>
                <option value="soft powdery pastel">Pastel Sec</option>
                <option value="fine pen and ink crosshatching">Plume & Encre</option>
                <option value="opaque gouache painting">Gouache</option>
                <option value="smooth airbrush gradients">A√©rographe</option>
                <option value="classic etching engraving">Gravure</option>
                <option value="raw spray paint street art">Bombe de Peinture</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="medium_custom" class="custom-input">

            <label style="margin-top:10px;">Fusion</label>
            <select id="fusion" onchange="toggleCustom(this)">
                <option value="none" selected disabled>-- Choisir Fusion --</option>
                <option value="sculpted by crashing ocean waves and sea foam">Fusion Oc√©anique</option>
                <option value="dissolving into vibrant organic pigments">Dissolution (Paint)</option>
                <option value="emanating liquid energy from the skin">√âmanation (Suintement)</option>
                <option value="with explosive dynamic paint splashes">Cin√©tique (Splashes)</option>
                <option value="integrated into elegant ribbon-like curves">Rubans (Visage)</option>
                <option value="metamorphosing into crystalline structures">Cristallisation</option>
                <option value="surrounded by floating mercury droplets">Mercure Liquide</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="fusion_custom" class="custom-input">
        </div>

        <div>
            <h2>üìê Structure & Focus</h2>
            <label>Viscosit√©</label>
            <select id="viscosity" onchange="toggleCustom(this)">
                <option value="none" selected disabled>-- Choisir Viscosit√© --</option>
                <option value="watery and translucent">Aqueuse (Translucide)</option>
                <option value="viscous and dripping">Liquide (Coulures)</option>
                <option value="thick and textured">Visqueuse (Huile)</option>
                <option value="glowing and ethereal">√âth√©r√©e (N√©on)</option>
                <option value="metallic and reflective">M√©tallique</option>
                <option value="oily and iridescent">Huileuse Iridescente</option>
                <option value="glassy and fragile">Vitreuse</option>
                <option value="crystalline and sharp">Cristalline</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="viscosity_custom" class="custom-input">

            <label style="margin-top:10px;">Focus Anatomique</label>
            <select id="focus" onchange="toggleCustom(this)">
                <option value="none" selected disabled>-- Choisir Focus --</option>
                <option value="close-up profile portrait">Portrait de Profil</option>
                <option value="full body dynamic pose">Corps Entier</option>
                <option value="upper body bust">Buste & Torse</option>
                <option value="macro detail of hands">Macro (Mains)</option>
                <option value="extreme close-up on eyes">Regard</option>
                <option value="low-angle heroic shot">Contre-plong√©e</option>
                <option value="wide-angle cinematic shot">Plan Large</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="focus_custom" class="custom-input">
        </div>

        <div>
            <h2>üß± Mat√©riau & Lieu</h2>
            <label>Mat√©riau de Base</label>
            <select id="material" onchange="toggleCustom(this)">
                <option value="none" selected disabled>-- Choisir Mat√©riau --</option>
                <option value="crafted from heavy obsidian">Obsidienne Noire</option>
                <option value="made of polished gold enamel">√âmail Or</option>
                <option value="textured like cracked plaster">Pl√¢tre Craquel√©</option>
                <option value="woven from luminous silk">Soie Lumineuse</option>
                <option value="sculpted from white marble">Marbre Blanc</option>
                <option value="rusted weathered chrome">Chrome Rouill√©</option>
                <option value="soft liquid velvet">Velours Liquide</option>
                <option value="etched translucent porcelain">Porcelaine</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="material_custom" class="custom-input">

            <label style="margin-top:10px;">Lieu</label>
            <select id="loc" onchange="toggleCustom(this)">
                <option value="none" selected disabled>-- Choisir Lieu --</option>
                <option value="facing a massive planet Jupiter">Face √† Jupiter</option>
                <option value="at an oasis with pyramids">Oasis & Pyramides</option>
                <option value="on a minimalist white background">Fond Blanc</option>
                <option value="standing on a jagged cliff">Falaise</option>
                <option value="inside a bioluminescent cave">Grotte</option>
                <option value="in Moscow Red Square">Place Rouge</option>
                <option value="on Brooklyn Bridge">Pont de Brooklyn</option>
                <option value="in Angkor Wat temple">Temple d'Angkor</option>
                <option value="in a flooded ancient temple">Temple Englouti</option>
                <option value="custom">-- Personnaliser --</option>
            </select>
            <input type="text" id="loc_custom" class="custom-input">
        </div>

        <div class="full-width">
            <h2>üéÅ Boutique & Objets</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label>Objet Souvenir</label>
                    <select id="souvenir" onchange="autoRatio(); toggleBoutiqueCustom()">
                        <option value="none" selected disabled>-- Choisir Objet --</option>
                        <option value="vertical cinema poster">Affiche Cin√©ma (V)</option>
                        <option value="horizontal cinema poster">Affiche Cin√©ma (H)</option>
                        <option value="vertical art poster">Poster Artistique (V)</option>
                        <option value="horizontal art poster">Poster Artistique (H)</option>
                        <option value="retro comic book cover">Couverture de BD (Comic)</option>
                        <option value="printed on a circular cardboard beer coaster">Sous-bock pour bi√®re</option>
                        <option value="encased in a clear acrylic keychain frame">Porte-cl√© Cadre (2D)</option>
                        <option value="as a detailed 3D sculpted relief keychain">Porte-cl√© Sculpter (3D)</option>
                        <option value="etched onto a collector coin">Pi√®ce de collection</option>
                        <option value="inside a snow globe">Boule √† Neige</option>
                        <option value="as a mystical tarot card">Carte de Tarot</option>
                        <option value="vintage polaroid photo">Photo Polaroid</option>
                        <option value="high-quality cinematic film still of a TV studio set">Photo Plateau TV</option>
                        <option value="museum information placard">Plaque de Mus√©e</option>
                        <option value="architectural blueprint drawing">Plan technique (Blueprint)</option>
                        <option value="medieval stained glass window">Vitrail m√©di√©val</option>
                        <option value="commemorative currency note">Billet de Banque</option>
                        <option value="surrealist postage stamp">Timbre poste</option>
                        <option value="custom">-- Personnaliser --</option>
                    </select>
                    <input type="text" id="souvenir_custom" class="custom-input">
                </div>
                <div>
                    <label>Format & Ratio</label>
                    <select id="ratio" onchange="toggleCustom(this)">
                        <option value="none" selected disabled>-- Choisir Format --</option>
                        <option value="16:9">16:9</option>
                        <option value="9:16">9:16</option>
                        <option value="21:9">21:9</option>
                        <option value="2:1">2:1</option>
                        <option value="1:1">1:1</option>
                        <option value="3:2">3:2</option>
                        <option value="2:3">2:3</option>
                        <option value="5:4">5:4</option>
                        <option value="custom">-- Personnaliser --</option>
                    </select>
                    <input type="text" id="ratio_custom" class="custom-input" placeholder="Ex: 4:3">
                </div>
            </div>

            <div id="boutique-custom-fields" class="boutique-custom-box">
                <label style="color: var(--neon-pink); font-size: 0.8em; margin-bottom: 10px; font-weight: bold;">üìú PERSONNALISATION DE L'OBJET :</label>
                <div class="boutique-grid">
                    <div><label>Titre de l'≈ìuvre</label><input type="text" id="obj_title" placeholder="Ex: ALICE AU PAYS DES N√âONS"></div>
                    <div>
                        <label>Style Typographie</label>
                        <select id="obj_typo">
                            <option value="bold typography">Cinematic (Classique)</option>
                            <option value="sharp gothic lettering">Gothic (M√©di√©val)</option>
                            <option value="vibrant neon signage style">Neon (Cyber-vif)</option>
                            <option value="elegant art-deco style">Art Deco (R√©tro Chic)</option>
                            <option value="rustic western woodcut">Western (Rustique)</option>
                        </select>
                    </div>
                    <div><label>Noms (Acteurs/Sujets)</label><input type="text" id="obj_actors" placeholder="Ex: Einstein, Goldorak"></div>
                    <div><label>Date / Texte bas</label><input type="text" id="obj_date" placeholder="Ex: Release 2026"></div>
                    <div><label>Description du Logo</label><input type="text" id="obj_logo" placeholder="Ex: Un petit lapin blanc"></div>
                </div>
            </div>
        </div>

        <div class="full-width">
            <h2>üß™ Laboratoire des Styles (Pond√©rables)</h2>
            <div id="style-container"></div>
        </div>
    </div>

    <button class="btn-main" onclick="generate()">üöÄ FORGER LE CHEF-D'≈íUVRE</button>
    <div style="display: flex; justify-content: space-between;">
        <button class="btn-surprise" onclick="randomize()">üé≤ SURPRISE ALCHIMIQUE</button>
        <button class="btn-reset" onclick="resetForge()">üßπ R√âINITIALISER LA FORGE</button>
    </div>
    <button class="btn-copy" onclick="copyPrompt()">üìã COPIER LE PROMPT COMPLET</button>
    
    <div class="output-box"><code id="finalPrompt">S√©lectionnez vos ingr√©dients alchimiques...</code></div>
</div>

<script>
    const styles = ["Photorealistic Fluid Dynamics", "Andino Surrealism", "Moscow Caricature", "Vintage Space Anime", "Black Space Aesthetic", "Absurealism", "Icy Blue Palette", "Pixar 3D Render", "Japanese Ukiyo-e", "Hyperrealism", "Dystopian Grit", "Modern Folk Art", "Studio Ghibli Painting", "Cyberpunk Noir", "Vaporwave Dreams", "Art Nouveau", "Synthwave 80s", "Ethereal Watercolor", "Gothic Horror", "Minimalism", "Glitch Art", "Linocut Print", "Steampunk Brass", "Baroque Chiaroscuro", "Byzantine Mosaic", "Impressionism", "Surrealist Collage", "Abstract Expressionism", "Solar-Folk"];

    function setup() {
        const container = document.getElementById('style-container');
        for(let i=1; i<=3; i++) {
            const row = document.createElement('div');
            row.className = 'style-row';
            row.innerHTML = `<select id="s${i}" onchange="toggleCustom(this)"><option value="none">-- Style ${i} --</option>` + 
                styles.map(s => `<option value="${s}">${s}</option>`).join('') + 
                `<option value="custom">-- Perso --</option></select><input type="number" id="w${i}" class="weight-num" value="0"><input type="text" id="s${i}_custom" class="custom-input">`;
            container.appendChild(row);
        }
    }

    function toggleCustom(el) {
        const c = document.getElementById(el.id + '_custom');
        if(c) c.style.display = (el.value === 'custom') ? 'block' : 'none';
    }

    function toggleBoutiqueCustom() {
        const s = document.getElementById('souvenir').value;
        const box = document.getElementById('boutique-custom-fields');
        const triggers = ['poster', 'comic', 'placard', 'tarot', 'currency', 'stamp', 'studio'];
        box.style.display = triggers.some(t => s.includes(t)) ? 'block' : 'none';
    }

    function setPalette(text) { document.getElementById('color_text').value = text; }
    function updateColorText(hex) { document.getElementById('color_text').value = "vibrant " + hex + " accents"; }

    function autoRatio() {
        const s = document.getElementById('souvenir').value;
        const r = document.getElementById('ratio');
        if(s.includes('stamp') || s.includes('currency')) r.value = "5:4";
        else if(s.includes('horizontal')) r.value = "3:2";
        else if(s.includes('vertical') || s.includes('comic') || s.includes('tarot')) r.value = "2:3";
        else if(s.includes('polaroid') || s.includes('beer') || s.includes('keychain') || s.includes('globe')) r.value = "1:1";
    }

    function resetForge() { location.reload(); }

    function randomize() {
        const selects = document.querySelectorAll('select');
        selects.forEach(sel => {
            const options = Array.from(sel.options).filter(opt => !opt.disabled && opt.value !== "custom");
            if (options.length > 0) {
                sel.value = options[Math.floor(Math.random() * options.length)].value;
                sel.dispatchEvent(new Event('change'));
            }
        });
        for(let i=1; i<=3; i++) document.getElementById('w'+i).value = Math.floor(Math.random() * 75) + 15;
        const harmonies = ['Ancient Gold and Black Obsidian', 'Vivid Neon Pink and Cyan', 'Primary Carnival Splashes', 'Pure High-Key White and Pastel Softness', 'Deep Monochrome and Silver highlights'];
        setPalette(harmonies[Math.floor(Math.random() * harmonies.length)]);
        document.getElementById('target_color').checked = Math.random() > 0.5;
        generate();
    }

    function generate() {
        const getV = (id) => {
            const sel = document.getElementById(id);
            if(!sel || sel.value === "none") return "";
            return (sel.value === 'custom') ? document.getElementById(id + '_custom').value : sel.value;
        };

        // --- D√âFINITION DES VARIABLES ---
        const char = getV('char');
        const charAttr = getV('char_attr');
        const act = getV('action');
        const loc = getV('loc');
        const companion = getV('companion');
        const compAttr = getV('comp_attr');
        const focus = getV('focus');
        const fusion = getV('fusion');
        const med = getV('medium');
        const visc = getV('viscosity');
        const light = getV('lighting');
        const mat = getV('material');
        const rat = getV('ratio');
        const souv = getV('souvenir');
        const colorVal = document.getElementById('color_text').value;
        const targetColor = document.getElementById('target_color').checked;
        
        let charPart = `${char} ${charAttr}`;
        let globalColor = "";
        
        if(colorVal) {
            if(targetColor) charPart += ` (rendered in ${colorVal} tones:1.3)`;
            else globalColor = `steeped in a ${colorVal} color palette, `;
        }

        let styleStr = "";
        for(let i=1; i<=3; i++) {
            const s = getV('s'+i);
            const w = document.getElementById('w'+i).value;
            if(s && w > 0) styleStr += `(${s}:${w/100}), `;
        }

        const title = document.getElementById('obj_title').value;
        const typo = getV('obj_typo');
        const actors = document.getElementById('obj_actors').value;
        const date = document.getElementById('obj_date').value;
        const logo = document.getElementById('obj_logo').value;

        let objText = `as a professional ${souv}`;
        if(title) objText += ` featuring the title '${title}' in ${typo}`;
        if(actors) objText += ` starring ${actors}`;
        if(date) objText += `, with a release date mentioned as ${date}`;
        if(logo) objText += `, including a [${logo}] logo at the bottom corner`;

        // --- CONSTRUCTION DU PROMPT (STRUCTURE √âQUILIBR√âE) ---
        const prompt = `Digital art masterpiece. ${globalColor}${charPart}, ${act} ${loc ? 'set in ' + loc : ''}, ${objText}, with ${companion} ${compAttr}, in a ${focus}, ${fusion}. A sophisticated alchemical fusion of ${styleStr} rendered using ${med}, dominated by a ${visc} texture. Illuminated by ${light}. ${mat}. High-contrast lighting, cinematic atmosphere, 8k. ${rat} format`;
        
        document.getElementById('finalPrompt').innerText = prompt + "\n\nPROMPT N√âGATIF : photograph, 3d render, text, signature, watermark, blurry, low resolution, distorted anatomy, messy colors, plastic skin, extra objects, duplicate items, multiple instances, fragmented elements, floating debris, out of place objects, color bleeding, background leaking, texture bleeding.";
    }

    function copyPrompt() { navigator.clipboard.writeText(document.getElementById('finalPrompt').innerText); alert("Prompt Master copi√© !"); }
    setup();
</script>
</body>
</html>
