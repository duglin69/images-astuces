<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Coloriages</title>
    <style>
        :root {
            --bg-color: #fdfbf7; /* Papier l√©g√®rement cr√®me */
            --panel-color: #ffffff;
            --text-color: #333333;
            --accent-color: #e67e22; /* Vert Crayon */
            --accent-hover: #8bc34a;
            --border-color: #d1d1d1;
            --input-bg: #fafafa;
        }

        body {
            font-family: 'Comic Sans MS', 'Verdana', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: var(--accent-color);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 1px 1px 0px #ccc;
            margin-bottom: 20px;
            border-bottom: 2px dashed var(--border-color);
            padding-bottom: 10px;
            width: 100%;
            text-align: center;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 30px;
        }

        .menu-block {
            background-color: var(--panel-color);
            border: 2px solid var(--border-color);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.05);
            position: relative;
        }

        .menu-label {
            display: block;
            font-size: 0.9em;
            color: #555;
            margin-bottom: 8px;
            font-weight: bold;
            text-transform: uppercase;
        }

        select, input[type="text"], input[type="number"] {
            width: 100%;
            background-color: var(--input-bg);
            color: #333;
            border: 2px solid var(--border-color);
            padding: 10px;
            font-family: inherit;
            font-size: 1em;
            box-sizing: border-box;
            border-radius: 6px;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--accent-color);
            background-color: #fff;
        }

        .custom-input {
            display: none;
            margin-top: 8px;
            border-left: 4px solid var(--accent-color);
            padding-left: 8px;
            font-style: italic;
            color: #666;
        }

        /* Zone de contr√¥le */
        .controls {
            width: 100%;
            max-width: 1200px;
            background-color: #fff;
            border: 2px solid var(--accent-color);
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 12px;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        button {
            background-color: var(--accent-color);
            color: #fff;
            border: none;
            padding: 12px 24px;
            font-family: inherit;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.3s;
            box-shadow: 0 4px 0px rgba(230, 126, 34, 0.2);
        }

        button:hover {
            background-color: #8bc34a;
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(230, 126, 34, 0.3);
        }

        button.secondary {
            background-color: #f0f0f0;
            color: #555;
            border: 2px solid #ccc;
            box-shadow: none;
            transform: none;
        }
        
        button.secondary:hover {
            background-color: #e0e0e0;
            border-color: #bbb;
            color: #000;
            transform: none;
            box-shadow: none;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            cursor: pointer;
            color: #555;
        }

        /* Zone de r√©sultat */
        .output-area {
            width: 100%;
            max-width: 1200px;
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            height: 120px;
            background-color: #fff;
            color: #000;
            border: 2px dashed #aaa;
            padding: 15px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            box-sizing: border-box;
            background-image: linear-gradient(0 0 0 0, transparent 50%), linear-gradient(45deg, #fff 25%, transparent 25%, #fff 75%, transparent);
            background-size: 20px 20px;
        }

        .negative-preview {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
            font-style: italic;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
            text-align: center;
        }

        /* Toast notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            border-bottom: 4px solid var(--accent-color);
            font-family: 'Courier New', monospace;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from {bottom: 0; opacity: 0;}
            to {bottom: 30px; opacity: 1;}
        }
        @keyframes fadeout {
            from {bottom: 30px; opacity: 1;}
            to {bottom: 0; opacity: 0;}
        }
    </style>
</head>
<body>

    <h1>G√©n√©rateur de Coloriages</h1>

    <div class="container" id="menus-container">
        <!-- Les menus seront g√©n√©r√©s ici par JavaScript -->
    </div>

    <div class="controls">
        <button onclick="generatePrompt()">G√©n√©rer le coloriage</button>
        <button onclick="surprisePrompt()" class="secondary">Id√©e Surprise</button>
        <button onclick="copyToClipboard()" class="secondary">Copier le prompt</button>
        <button onclick="resetAll()" class="secondary">Reset</button>
        <button onclick="exportTxt()" class="secondary">Exporter .txt</button>

        <div class="control-group">
            <div class="toggle-container" title="Pond√©rer le sujet et le style">
                <input type="checkbox" id="weight-toggle">
                <label for="weight-toggle">Boost D√©tails (1.2x)</label>
            </div>
            <div style="display: flex; align-items: center; gap: 5px;">
                <input type="number" id="seed-input" placeholder="Seed Auto" style="width: 100px;">
                <button type="button" onclick="randomizeSeed()" style="padding: 6px 10px;" title="G√©n√©rer un nouveau Seed al√©atoire">üé≤</button>
            </div>
        </div>
    </div>

    <div class="output-area">
        <label class="menu-label">Prompt pour Coloriage (Lignes Noires) :</label>
        <textarea id="output-positive" readonly placeholder="Le prompt appara√Ætra ici..."></textarea>
        
        <label class="menu-label" style="margin-top:10px; display:block;">Info N√©gatif (G√©n√©ral pour le Noir & Blanc) :</label>
        <div id="output-negative-preview" class="negative-preview">colored, full color, vibrant colors, shading, grayscale, realistic, 3d render, photorealistic, watercolor, oil painting, saturated, colorful</div>
    </div>

    <div id="toast">Prompt copi√© !</div>

    <script>
        // --- DONN√âES DES MENUS (THEME COLORIAGES) ---
        const menusData = [
            {
                title: "PERSONNAGE / SUJET",
                id: "menu_sujet",
                options: [
                    "Princesse Disney moderne",
                    "Princesse traditionnelle",
                    "Chevalier de galop",
                    "Pirate mignon",
                    "F√©e enchant√©e",
                    "Robot ami",
                    "Animal de la for√™t",
                    "Chat mignon",
                    "Super H√©ros (style BD)",
                    "Gardien du zoo",
                    "P√®re No√´l moderne",
                    "Voyageur du temps"
                ]
            },
            {
                title: "STYLE DE TRAIT",
                id: "menu_style_trait",
                options: [
                    "Ligne noire √©paisse et nette",
                    "Crayon de couleur (Crayon de bois)",
                    "Aquarelle gouach√©e",
                    "Illustration de livre pour enfants",
                    "Gravure sur bois",
                    "Croquis au crayon (Rough sketch)",
                    "Peinture √† l'aquarelle douce",
                    "Illustration vintage ann√©es 50",
                    "Style Manga / Shonen (contours nets)",
                    "Style Beldam (ligne claire)",
                    "Style American Golden Age"
                ]
            },
            {
                title: "COMPLEXIT√â",
                id: "menu_complexite",
                options: [
                    "Simple (peu de d√©tails, pour tout-petit)",
                    "Moyenne (contours propres, standard)",
                    "D√©taill√© (beaucoup de traits)"
                ]
            },
            {
                title: "ACTION / POSTURE",
                id: menu_action",
                options: [
                    "Assis dans une bulle √† vapeur",
                    "Lit dans un champ de fleurs",
                    "Court un dragon dans le ciel",
                    "Regarde par la fen√™tre",
                    "Mange une pomme",
                    "Ouvre un cadeau",
                    "Tire un fusil",
                    "Peint un tableau",
                    "Dort sur un nuage",
                    "Gagne une course"
                ]
            },
            {
                title: "ARRI√àRE-PLAN / D√âCOR",
                id: "menu_lieu",
                options: [
                    "Chambre d'enfant color√©e",
                    "Jardin secret",
                    "Ch√¢teau de conte de f√©es",
                    "For√™t enchant√©e",
                    "Fond spatial (Lune et √©toiles)",
                    "Paysage champ√™tre",
                    "Biblioth√®que magique",
                    "√âcole de sorciers",
                    "Paysage marin",
                    "Grotes grottes",
                    "Ville dessin anim√©"
                ]
            },
            {
                title: "OBJETS & D√âTAILS",
                id: "menu_objet",
                options: [
                    "Ballons de baudruche",
                    "Jouets en bois et rouille",
                    "Fleurs et papillons",
                    "Livre de contes",
                    "Lanterne magique",
                    "Baguette de sorcier",
                    "Couronne royale",
                    "√âp√©e √† glace",
                    "Petite voiture bleue",
                    "Panier picnic"
                ]
            },
            {
                title: "ARTISTES / STYLE VISUEL",
                id: menu_artiste,
                options: [
                    "Style Mary Blair (Disney classique)",
                    "Style Al Hirschfeld (Aquarelle douce)",
                    "Style Dr Seuss (Whimsical, rond)",
                    "Style Studio Ghibli (Anime clair)",
                    "Style Maurice Sendak (Contour dur, sombre)",
                    "Style Tim Burton (Gothique, tordu)",
                    "Style Arthur Rackham (F√©er, sombre, d√©taill√©)",
                    "Style Gustave Dor√© (Classique, d√©taill√©)",
                    "Style Hayao Miyazaki (Anime √©pique)"
                ]
            },
            {
                title: "FORMAT & PAPIER",
                id: "menu_format",
                options: [
                    "Format A4 (Portrait/Paysage)",
                    "Format A3 (Double A4)",
                    "Format Carr√© (Pour cartes postales)",
                    "Format 16:9 (Pour √©crans)"
                ]
            },
            {
                title: "QUALIT√â",
                id: menu_qualite,
                options: [
                    "Clean outlines (Nettoy√©)",
                    "High contrast (Contraste √©lev√©)",
                    "Shadows included (Ombres douces)",
                    "No shadows (Plat, pour colorier soi-m√™me)",
                    "Crisp edges (Bords nets)"
                ]
            }
        ];

        // Le Prompt N√©gatif est D√âJ√Ä PR√äT pour le Coloriage
        const negativePromptBase = "colored, full color, vibrant colors, shading, grayscale, realistic, 3d render, photorealistic, watercolor, oil painting, saturated, colorful";

        // --- INITIALISATION ---
        window.onload = function() {
            const container = document.getElementById('menus-container');
            
            menusData.forEach(menu => {
                const block = document.createElement('div');
                block.className = 'menu-block';

                const label = document.createElement('label');
                label.className = 'menu-label';
                label.textContent = menu.title;
                
                const select = document.createElement('select');
                select.id = menu.id;
                
                // Option par d√©faut
                const defaultOption = document.createElement('option');
                defaultOption.value = "Choisir";
                defaultOption.textContent = "Choisir";
                select.appendChild(defaultOption);

                // Options du menu
                menu.options.forEach(optText => {
                    const option = document.createElement('option');
                    option.value = optText;
                    option.textContent = optText;
                    select.appendChild(option);
                });

                // Option Custom
                const customOption = document.createElement('option');
                customOption.value = "Custom";
                customOption.textContent = "Custom";
                select.appendChild(customOption);

                // Input Custom (cach√©)
                const customInput = document.createElement('input');
                customInput.type = "text";
                customInput.id = "custom_" + menu.id;
                customInput.className = "custom-input";
                customInput.placeholder = "Ajoutez votre texte...";

                // √âv√©nement pour afficher l'input Custom
                select.addEventListener('change', function() {
                    if(this.value === "Custom") {
                        customInput.style.display = "block";
                        customInput.focus();
                    } else {
                        customInput.style.display = "none";
                    }
                });

                block.appendChild(label);
                block.appendChild(select);
                block.appendChild(customInput);
                container.appendChild(block);
            });
            
            updateNegativePreview();
        };

        // --- FONCTIONS LOGIQUES ---

        function generatePrompt() {
            let parts = [];
            let weighted = document.getElementById('weight-toggle').checked;
            
            // --- GESTION DU SEED ---
            const seedInput = document.getElementById('seed-input');
            let currentSeed = seedInput.value;

            // Si la case est vide, on g√©n√®re un seed al√©atoire (entre 1 et 999999999)
            // ET on l'affiche dans la case pour que l'utilisateur puisse le voir/copier
            if (!currentSeed) {
                currentSeed = Math.floor(Math.random() * 999999999) + 1;
                seedInput.value = currentSeed;
            }
            // ---------------------------------

            // On ajoute le style de base "Ligne noire" car c'est un coloriage
            parts.push("Ligne noire √©paisse, dessin au trait, noir et blanc, illustration pour enfants");

            menusData.forEach(menu => {
                const select = document.getElementById(menu.id);
                const val = select.value;
                let part = "";

                if (val === "Custom") {
                    const customInput = document.getElementById("custom_" + menu.id);
                    if (customInput.value.trim() !== "") {
                        part = customInput.value.trim();
                    }
                } else if (val !== "Choisir") {
                    part = val;
                }

                if (part) {
                    // Application de la pond√©ration si activ√©e
                    if (weighted) {
                        // On booste surtout l'Artiste
                        if (menu.id === "menu_artiste") {
                            part = `(${part}:1.2)`;
                        }
                    }
                    parts.push(part);
                }
            });

            const finalPrompt = parts.join(", ");
            document.getElementById('output-positive').value = finalPrompt;
            updateNegativePreview();
            return finalPrompt;
        }

        function updateNegativePreview() {
            // Pour le coloriage, on force un prompt n√©gatif simple qui √©vite la couleur
            const neg = negativePromptBase;
            document.getElementById('output-negative-preview').textContent = neg;
            return neg;
        }

        function getNegativePrompt() {
            return updateNegativePreview();
        }

        function surprisePrompt() {
            menusData.forEach(menu => {
                const select = document.getElementById(menu.id);
                const customInput = document.getElementById("custom_" + menu.id);
                const options = menu.options;
                
                // Choisir un index al√©atoire (excluant les 2 derni√®res options si besoin, mais ici on veut √©viter "Choisir" et "Custom")
                const randomIndex = Math.floor(Math.random() * options.length);
                
                select.value = options[randomIndex];
                
                // Cacher l'input custom au cas o√π
                customInput.style.display = "none";
                customInput.value = "";
            });
            generatePrompt();
        }

        function resetAll() {
            menusData.forEach(menu => {
                const select = document.getElementById(menu.id);
                const customInput = document.getElementById("custom_" + menu.id);
                select.value = "Choisir";
                customInput.style.display = "none";
                customInput.value = "";
            });
            document.getElementById('output-positive').value = "";
            document.getElementById('seed-input').value = "";
            document.getElementById('weight-toggle').checked = false;
            updateNegativePreview();
        }

        async function copyToClipboard() {
            const positive = generatePrompt();
            const negative = getNegativePrompt();
            const textToCopy = `${positive}\n\nNegative Prompt:\n${negative}`;
            
            try {
                await navigator.clipboard.writeText(textToCopy);
                showToast();
            } catch (err) {
                console.error('Erreur de copie : ', err);
                alert("Erreur lors de la copie automatique. Veuillez copier manuellement.");
            }
        }

        function exportTxt() {
            const positive = generatePrompt();
            const negative = getNegativePrompt();
            const seed = document.getElementById('seed-input').value || "Auto-Al√©atoire";
            
            let content = `--- GENERATEUR DE COLORIAGES ---\n\n`;
            content += `[SEED]: ${seed}\n\n`;
            content += `[PROMPT]:\n${positive}\n\n`;
            content += `[INFO N√âGATIF]:\n${negative}\n\n`;
            content += `[DETAILS SELECTIONNES]:\n`;
            
            menusData.forEach(menu => {
                const val = document.getElementById(menu.id).value;
                if(val === "Custom") {
                    const cVal = document.getElementById("custom_" + menu.id).value;
                    content += `- ${menu.title}: ${cVal || "Vide"}\n`;
                } else if (val !== "Choisir") {
                    content += `- ${menu.title}: ${val}\n`;
                }
            });

            const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `coloriage_prompt_${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showToast() {
            const toast = document.getElementById("toast");
            toast.className = "show";
            setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
        }

        function randomizeSeed() {
            const newSeed = Math.floor(Math.random() * 999999999) + 1;
            document.getElementById('seed-input').value = newSeed;
        }
    </script>
</body>
</html>
