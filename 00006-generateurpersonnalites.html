<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>G√©n√©rateur de Prompts Personnalis√©s - √âDITION ULTIME</title>
<style>
/* Tous les styles CSS pr√©c√©dents restent identiques */
:root {
  --primary: #0a0a1a;
  --secondary: #1a1a3a;
  --accent: #00d4ff;
  --accent2: #ff6b6b;
  --accent3: #4ecdc4;
  --accent4: #9d4edd;
  --text: #e8f4ff;
  --card-bg: rgba(0, 20, 40, 0.8);
  --card-bg2: rgba(10, 30, 60, 0.6);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: var(--text);
  padding: 20px;
  line-height: 1.6;
  min-height: 100vh;
}

.container {
  max-width: 2000px;
  margin: 0 auto;
  background: linear-gradient(135deg, var(--card-bg), var(--card-bg2));
  padding: 40px;
  border-radius: 30px;
  box-shadow: 0 30px 100px rgba(0, 212, 255, 0.2);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(0, 212, 255, 0.1);
}

h1 {
  text-align: center;
  font-size: 2.8em;
  margin-bottom: 20px;
  text-shadow: 0 0 30px var(--accent);
  background: linear-gradient(to right, #00d4ff, #ff6b6b, #9d4edd);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.subtitle {
  text-align: center;
  font-size: 1.3em;
  margin-bottom: 40px;
  color: #88ccff;
}

/* GRID SYSTEM */
.grid-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 25px;
  margin-bottom: 30px;
}

.section {
  background: rgba(0, 10, 25, 0.5);
  border-radius: 20px;
  padding: 25px;
  border-left: 5px solid var(--accent);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  transition: transform 0.3s;
}

.section:hover {
  transform: translateY(-5px);
}

.section-title {
  font-size: 1.4em;
  margin-bottom: 20px;
  color: var(--accent);
  border-bottom: 2px solid var(--accent);
  padding-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title::before {
  content: "‚ú¶";
  font-size: 1.2em;
}

/* FORM ELEMENTS */
select, input[type="text"], textarea {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border-radius: 12px;
  border: 2px solid var(--accent);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  margin-bottom: 15px;
  transition: all 0.3s;
  cursor: pointer;
}

select:focus, input[type="text"]:focus, textarea:focus {
  outline: none;
  box-shadow: 0 0 20px var(--accent);
  border-color: #00ff88;
}

select option {
  background: #0a0a2a;
  padding: 10px;
}

.custom-input {
  margin-top: 10px;
  border-color: #ff6b6b !important;
}

.custom-input::placeholder {
  color: #ff9999;
}

.input-group {
  position: relative;
  margin-bottom: 15px;
}

.input-label {
  display: block;
  margin-bottom: 8px;
  color: #88ccff;
  font-size: 0.9em;
  font-weight: bold;
}

.input-hint {
  font-size: 0.8em;
  color: #66aaff;
  margin-top: 5px;
  padding: 5px 10px;
  background: rgba(0, 30, 60, 0.3);
  border-radius: 5px;
}

.checkbox-group {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin: 20px 0;
}

.checkbox-item {
  display: flex;
  align-items: center;
  gap: 8px;
}

.checkbox-item input {
  width: 18px;
  height: 18px;
}

/* PROMPT OUTPUT */
.prompt-container {
  margin-top: 40px;
  padding: 30px;
  background: linear-gradient(135deg, #000, #111, #000);
  border-radius: 20px;
  border: 3px solid var(--accent);
  box-shadow: inset 0 0 30px rgba(0, 255, 136, 0.1);
}

#promptOutput {
  width: 100%;
  min-height: 300px;
  background: transparent;
  color: #00ff88;
  font-family: 'Fira Code', 'Consolas', monospace;
  font-size: 16px;
  line-height: 1.5;
  padding: 20px;
  border: none;
  resize: vertical;
  border-radius: 10px;
}

/* BUTTONS */
.button-group {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 20px;
  margin: 30px 0;
}

button {
  padding: 18px 35px;
  font-size: 18px;
  border-radius: 15px;
  border: none;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  min-width: 200px;
}

#generateBtn {
  background: linear-gradient(135deg, #00d4ff, #00b8ff);
  color: #000;
  font-size: 20px;
}

#randomAllBtn {
  background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
  color: white;
}

#copyBtn {
  background: linear-gradient(135deg, #4ecdc4, #44a08d);
  color: #000;
}

#clearBtn {
  background: linear-gradient(135deg, #9d4edd, #560bad);
  color: white;
}

button:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
}

button:active {
  transform: translateY(0);
}

/* PERSONALITIES GRID */
.personalities-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 15px;
  margin-top: 15px;
  max-height: 300px;
  overflow-y: auto;
  padding: 10px;
}

.personality-card {
  background: rgba(0, 20, 40, 0.6);
  border-radius: 10px;
  padding: 15px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  border: 1px solid transparent;
}

.personality-card:hover {
  border-color: var(--accent);
  background: rgba(0, 40, 80, 0.6);
}

.personality-card.selected {
  border-color: #00ff88;
  background: rgba(0, 40, 30, 0.6);
}

.personality-category {
  font-size: 0.8em;
  color: #88ccff;
  margin-top: 5px;
}

/* CONTROLS */
.controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 20px;
  margin: 25px 0;
  padding: 20px;
  background: rgba(0, 15, 30, 0.5);
  border-radius: 15px;
}

.control-group {
  display: flex;
  align-items: center;
  gap: 15px;
}

/* RESPONSIVE */
@media (max-width: 1200px) {
  .grid-container {
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  }
}

@media (max-width: 768px) {
  .container {
    padding: 20px;
  }
  
  h1 {
    font-size: 2em;
  }
  
  .button-group {
    flex-direction: column;
  }
  
  button {
    width: 100%;
  }
  
  .controls {
    flex-direction: column;
    align-items: stretch;
  }
}

/* SCROLLBAR */
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: rgba(0, 10, 25, 0.5);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: #00b8ff;
}

/* COUNTER */
.counter {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(255, 107, 107, 0.9);
  color: white;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  font-weight: bold;
  box-shadow: 0 5px 20px rgba(255, 107, 107, 0.5);
  z-index: 1000;
}

/* TOOLTIPS */
.tooltip {
  position: relative;
  display: inline-block;
  margin-left: 5px;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 200px;
  background-color: rgba(0, 0, 0, 0.9);
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 10px;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  transform: translateX(-50%);
  opacity: 0;
  transition: opacity 0.3s;
  font-size: 14px;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}

/* LOADING ANIMATION */
.loading {
  display: none;
  text-align: center;
  margin: 20px 0;
}

.loading span {
  display: inline-block;
  width: 10px;
  height: 10px;
  margin: 0 5px;
  background-color: var(--accent);
  border-radius: 50%;
  animation: loading 1.4s infinite ease-in-out both;
}

.loading span:nth-child(1) { animation-delay: -0.32s; }
.loading span:nth-child(2) { animation-delay: -0.16s; }

@keyframes loading {
  0%, 80%, 100% { transform: scale(0); }
  40% { transform: scale(1.0); }
}

/* SWITCH TOGGLE */
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 30px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 34px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 22px;
  width: 22px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: var(--accent);
}

input:checked + .slider:before {
  transform: translateX(30px);
}

/* CUSTOM INPUT HIGHLIGHT */
.custom-active {
  border-color: #00ff88 !important;
  box-shadow: 0 0 15px rgba(0, 255, 136, 0.3) !important;
  background: rgba(0, 40, 20, 0.7) !important;
}

/* SECTION REPLIABLE */
.collapsible {
  cursor: pointer;
  margin-top: 20px;
}

.collapsible-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-out;
}

.collapsible-content.expanded {
  max-height: 1000px;
}

.collapsible-icon {
  transition: transform 0.3s;
  display: inline-block;
  margin-right: 10px;
}

.collapsible-icon.rotated {
  transform: rotate(90deg);
}

/* Styles pour le s√©lecteur de couleur */
input[type="color"] {
  border: 2px solid var(--accent);
  border-radius: 8px;
  background: transparent;
  cursor: pointer;
}

input[type="color"]::-webkit-color-swatch-wrapper {
  padding: 0;
}

input[type="color"]::-webkit-color-swatch {
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 6px;
}

/* Aper√ßu de la couleur HEX */
#colorHex {
  font-family: 'Fira Code', monospace;
  font-weight: bold;
  padding: 2px 6px;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 4px;
  margin-left: 5px;
}

/* Indicateur de densit√© */
.density-low { color: #ff6b6b !important; }
.density-medium { color: #ffa500 !important; }
.density-high { color: #00ff88 !important; }
.density-very-high { color: #ff00ff !important; }

/* Styles pour la galerie de r√©f√©rences */
.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
  border-bottom: 2px solid var(--accent);
  padding-bottom: 10px;
}

.tab-button {
  padding: 10px 20px;
  background: rgba(0, 20, 40, 0.6);
  border: 2px solid transparent;
  border-radius: 10px 10px 0 0;
  color: var(--text);
  cursor: pointer;
  transition: all 0.3s;
  font-weight: bold;
}

.tab-button:hover {
  background: rgba(0, 212, 255, 0.2);
}

.tab-button.active {
  background: var(--accent);
  color: #000;
  border-bottom: 3px solid #000;
}

.tab-content {
  display: none;
  animation: fadeIn 0.5s ease-out;
}

.tab-content.active {
  display: block;
}

.reference-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 15px;
  margin: 20px 0;
}

.reference-item {
  background: rgba(0, 15, 30, 0.5);
  border-radius: 10px;
  padding: 15px;
  cursor: pointer;
  transition: all 0.3s;
  text-align: center;
  border: 2px solid transparent;
}

.reference-item:hover {
  transform: translateY(-5px);
  border-color: var(--accent);
  box-shadow: 0 10px 20px rgba(0, 212, 255, 0.2);
  background: rgba(0, 30, 60, 0.7);
}

.reference-preview {
  width: 100%;
  height: 120px;
  border-radius: 8px;
  margin-bottom: 10px;
  background-size: cover;
  background-position: center;
  border: 2px solid rgba(255, 255, 255, 0.1);
}

.reference-item span {
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
  color: #e8f4ff;
}

.reference-item small {
  color: #88ccff;
  font-size: 0.8em;
}

/* Animation pour le changement d'onglet */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== NOUVEAUX STYLES POUR LES AM√âLIORATIONS ===== */

/* Moteurs IA */
.engine-option-group {
  background: rgba(0, 20, 40, 0.3);
  border-radius: 12px;
  padding: 20px;
  margin-top: 15px;
  border-left: 3px solid var(--accent);
  animation: fadeIn 0.3s ease-out;
}

/* Syst√®me de profils */
.profile-buttons {
  display: flex;
  gap: 10px;
  margin-top: 15px;
  flex-wrap: wrap;
}

.profile-button {
  padding: 10px 15px;
  background: rgba(0, 212, 255, 0.2);
  border: 1px solid var(--accent);
  border-radius: 8px;
  color: var(--text);
  cursor: pointer;
  transition: all 0.3s;
  font-size: 14px;
}

.profile-button:hover {
  background: rgba(0, 212, 255, 0.4);
}

.profile-button.active {
  background: var(--accent);
  color: #000;
}

/* Analyse de prompt */
.analysis-panel {
  background: rgba(0, 15, 30, 0.5);
  border-radius: 12px;
  padding: 20px;
  margin-top: 20px;
  border: 1px solid var(--accent4);
}

.analysis-metric {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.analysis-bar {
  height: 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
  margin: 10px 0;
  overflow: hidden;
}

.analysis-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.5s;
}

/* Palettes de couleurs */
.color-palette {
  display: flex;
  gap: 5px;
  margin: 10px 0;
}

.color-swatch {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  cursor: pointer;
  transition: transform 0.2s;
  border: 2px solid rgba(255, 255, 255, 0.3);
}

.color-swatch:hover {
  transform: scale(1.1);
}

.color-name {
  font-size: 0.8em;
  text-align: center;
  margin-top: 5px;
}

/* Composition */
.composition-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 15px;
  margin: 20px 0;
}

.composition-item {
  background: rgba(0, 20, 40, 0.5);
  border-radius: 10px;
  padding: 15px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
}

.composition-item:hover {
  transform: translateY(-5px);
  background: rgba(0, 212, 255, 0.2);
}

/* Tutoriel */
.tutorial-step {
  background: rgba(157, 78, 221, 0.1);
  border-radius: 12px;
  padding: 20px;
  margin: 20px 0;
  border-left: 4px solid var(--accent4);
}

.tutorial-navigation {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
}

/* Multi-personnages */
.character-section {
  background: rgba(255, 107, 107, 0.1);
  border-radius: 12px;
  padding: 20px;
  margin: 15px 0;
  border: 1px solid rgba(255, 107, 107, 0.3);
}

.remove-character {
  background: rgba(255, 107, 107, 0.2);
  color: #ff6b6b;
  border: 1px solid #ff6b6b;
  padding: 5px 10px;
  border-radius: 5px;
  cursor: pointer;
  margin-top: 10px;
}

</style>
</head>
<body>
<div class="container">
  <h1>üé≠ G√âN√âRATEUR DE PROMPTS - √âDITION ULTIME</h1>
  <p class="subtitle">Toutes les am√©liorations int√©gr√©es ‚Ä¢ Moteurs IA ‚Ä¢ Profils ‚Ä¢ Analyse ‚Ä¢ Composition</p>
  
  <!-- SYST√àME DE PROFILS -->
  <div class="section">
    <h2 class="section-title">üíæ PROFILS & PR√âS√âLECTIONS</h2>
    <div class="input-group">
      <div class="input-label">Gestion des profils :</div>
      <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <button class="profile-button" onclick="saveProfile()">üíæ Sauvegarder</button>
        <button class="profile-button" onclick="loadProfile()">üìÇ Charger</button>
        <button class="profile-button" onclick="deleteProfile()">üóëÔ∏è Supprimer</button>
        <button class="profile-button" onclick="resetProfiles()">üîÑ R√©initialiser</button>
      </div>
    </div>
    
    <div class="input-group">
      <div class="input-label">Nom du profil :</div>
      <input type="text" id="profileName" placeholder="Ex: Fantasy, Portrait, Cyberpunk...">
    </div>
    
    <div class="input-group">
      <div class="input-label">Profils sauvegard√©s :</div>
      <select id="profilesList" onchange="selectProfile(this.value)">
        <option value="">-- Choisir un profil --</option>
      </select>
      <div class="input-hint">Les profils sont sauvegard√©s dans votre navigateur</div>
    </div>
    
    <div class="profile-buttons" id="presetButtons">
      <!-- Rempli par JavaScript -->
    </div>
  </div>
  
  <!-- MOTEUR D'IA -->
  <div class="section">
    <h2 class="section-title">ü§ñ MOTEUR D'IA</h2>
    <div class="input-group">
      <div class="input-label">Moteur cible :</div>
      <select id="aiEngine" onchange="updateEngineOptions()">
        <option value="midjourney">Midjourney (V5/V6)</option>
        <option value="stable-diffusion">Stable Diffusion</option>
        <option value="dall-e">DALL-E 3</option>
        <option value="leonardo">Leonardo.ai</option>
        <option value="general" selected>G√©n√©ral / Autre</option>
      </select>
    </div>
    
    <div id="engineOptions" style="display: none;">
      <!-- Options sp√©cifiques charg√©es dynamiquement -->
    </div>
  </div>
  
  <!-- MODES CR√âATIFS -->
  <div class="section">
    <h2 class="section-title">‚öôÔ∏è MODES CR√âATIFS</h2>
    <div class="checkbox-group">
      <div class="checkbox-item">
        <input type="checkbox" id="modeRandom" checked>
        <label for="modeRandom">Mode Al√©atoire</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="modeAnachronique">
        <label for="modeAnachronique">Anachronismes</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="modeHumoristique">
        <label for="modeHumoristique">Humour</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="modeSurrealiste">
        <label for="modeSurrealiste">Surr√©alisme</label>
      </div>
    </div>
  </div>
  
  <!-- ANALYSE DE PROMPT -->
  <div class="section">
    <h2 class="section-title">üìä ANALYSE DU PROMPT</h2>
    <div class="analysis-panel">
      <div class="analysis-metric">
        <span>Longueur :</span>
        <span id="lengthScore">0 mots</span>
      </div>
      <div class="analysis-metric">
        <span>D√©tails :</span>
        <span id="detailScore">Faible</span>
      </div>
      <div class="analysis-metric">
        <span>Complexit√© :</span>
        <span id="complexityScore">Simple</span>
      </div>
      <div class="analysis-bar">
        <div class="analysis-fill" id="qualityBar" style="width: 0%; background: linear-gradient(90deg, #ff6b6b, #00ff88);"></div>
      </div>
      <div id="analysisTips" style="font-size: 0.9em; color: #88ccff; margin-top: 10px;">
        <!-- Conseils affich√©s dynamiquement -->
      </div>
    </div>
  </div>
  
  <!-- GRID PRINCIPAL -->
  <div class="grid-container">
    
    <!-- PERSONNALIT√âS -->
    <div class="section">
      <h2 class="section-title">üé≠ PERSONNALIT√â</h2>
      <div class="personalities-grid" id="personalitiesGrid">
        <!-- Rempli par JavaScript -->
      </div>
      <div class="input-group">
        <select id="personalitySelect" onchange="selectPersonality(this.value)">
          <option value="">-- Choisir une personnalit√© --</option>
        </select>
      </div>
      <div class="input-group">
        <input type="text" id="customPersonality" class="custom-input" placeholder="Personnalit√© personnalis√©e...">
      </div>
    </div>
    
    <!-- GENRE & FORMAT -->
    <div class="section">
      <h2 class="section-title">üë§ GENRE & FORMAT</h2>
      <div class="input-group">
        <div class="input-label">Genre :</div>
        <select id="genre">
          <option value="">Non sp√©cifi√©</option>
          <option value="homme">Homme</option>
          <option value="femme">Femme</option>
          <option value="non-binaire">Non-binaire</option>
          <option value="mixte">Mixte</option>
          <option value="autre">Autre</option>
        </select>
      </div>
      <div class="input-group">
        <div class="input-label">Format :</div>
        <select id="format">
          <option value="plan large cin√©matographique 16:9">16:9 (Cin√©matographique)</option>
          <option value="plan large ultra-large 21:9">21:9 (Large)</option>
          <option value="cadrage carr√© 1:1">1:1 (Carr√©)</option>
          <option value="portrait 9:16">9:16 (Portrait)</option>
          <option value="panoramique 3:1">3:1 (Panoramique)</option>
          <option value="IMAX 1.43:1">IMAX (1.43:1)</option>
        </select>
      </div>
    </div>
    
    <!-- ACTION -->
    <div class="section">
      <h2 class="section-title">üé¨ ACTION</h2>
      <div class="input-group">
        <select id="action" onchange="clearCustom('customAction')">
          <option value="">-- Choisir une action --</option>
        </select>
      </div>
      <div class="input-group">
        <input type="text" id="customAction" class="custom-input" placeholder="Action personnalis√©e...">
      </div>
    </div>
    
    <!-- LIEU -->
    <div class="section">
      <h2 class="section-title">üìç LIEU</h2>
      <div class="input-group">
        <select id="lieu" onchange="clearCustom('customLieu')">
          <option value="">-- Choisir un lieu --</option>
        </select>
      </div>
      <div class="input-group">
        <input type="text" id="customLieu" class="custom-input" placeholder="Lieu personnalis√©...">
      </div>
    </div>
    
    <!-- STYLE ARTISTIQUE -->
    <div class="section">
      <h2 class="section-title">üé® STYLE</h2>
      <div class="input-group">
        <select id="style" onchange="clearCustom('customStyle')">
          <option value="">-- Choisir un style --</option>
        </select>
      </div>
      <div class="input-group">
        <textarea id="customStyle" class="custom-input" rows="3" placeholder="Style personnalis√©..."></textarea>
      </div>
    </div>
    
    <!-- √âCLAIRAGE -->
    <div class="section">
      <h2 class="section-title">üí° √âCLAIRAGE</h2>
      <div class="input-group">
        <select id="eclairage" onchange="clearCustom('customEclairage')">
          <option value="">-- Choisir un √©clairage --</option>
        </select>
      </div>
      <div class="input-group">
        <input type="text" id="customEclairage" class="custom-input" placeholder="√âclairage personnalis√©...">
      </div>
    </div>
    
    <!-- PALETTES DE COULEURS -->
    <div class="section">
      <h2 class="section-title">üé® PALETTES DE COULEURS</h2>
      <div class="color-palette" id="colorPalette">
        <!-- Rempli par JavaScript -->
      </div>
      <div class="input-group">
        <div class="input-label">Palette :</div>
        <select id="colorTheme" onchange="updateColorPalette(); clearCustom('customColors');">
          <option value="warm">Chaude (Rouge/Orange)</option>
          <option value="cool">Froide (Bleu/Vert)</option>
          <option value="pastel">Pastel</option>
          <option value="neon">N√©on</option>
          <option value="monochrome">Monochrome</option>
        </select>
      </div>
      <div class="input-group">
        <input type="text" id="customColors" class="custom-input" placeholder="Couleurs personnalis√©es...">
      </div>
    </div>
    
    <!-- COMPOSITION -->
    <div class="section">
      <h2 class="section-title">üìê COMPOSITION</h2>
      <div class="composition-grid" id="compositionGrid">
        <!-- Rempli par JavaScript -->
      </div>
      <div class="input-group">
        <div class="input-label">Type de composition :</div>
        <select id="compositionType">
  <option value="">Standard</option>
  <option value="regle-des-tiers">R√®gle des tiers</option>
  <option value="symetrie">Sym√©trie</option>
  <option value="lignes-directrices">Lignes directrices</option>
  <option value="cadre-dans-le-cadre">Cadre dans le cadre</option>
</select>
      </div>
    </div>
    
    <!-- MULTI-PERSONNAGES -->
    <div class="section">
      <h2 class="section-title">üë• MULTI-PERSONNAGES</h2>
      <div id="charactersContainer">
        <!-- Sections de personnages ajout√©es dynamiquement -->
      </div>
      <button onclick="addCharacter()" style="width: 100%; margin-top: 10px;">+ Ajouter un personnage</button>
    </div>
    
  </div> <!-- Fin grid-container -->
  
  <!-- CONTROLS -->
  <div class="controls">
    <div class="control-group">
      <input type="checkbox" id="autoCopy" checked>
      <label for="autoCopy">Copie auto</label>
    </div>
    <div class="control-group">
      <span>Prompt #<span id="promptCount">0</span></span>
    </div>
    <div class="control-group">
      <button onclick="toggleTutorial()" id="tutorialToggle">üéì Tutoriel</button>
    </div>
  </div>
  
  <!-- BOUTONS PRINCIPAUX -->
  <div class="button-group">
    <button id="generateBtn" onclick="generatePrompt()">
      <span>üöÄ</span> G√âN√âRER
    </button>
    <button id="randomAllBtn" onclick="randomizeAll()">
      <span>üé≤</span> RANDOM
    </button>
    <button id="copyBtn" onclick="copyPrompt()">
      <span>üìã</span> COPIER
    </button>
    <button id="clearBtn" onclick="clearAll()">
      <span>üóëÔ∏è</span> EFFACER
    </button>
  </div>
  
  <!-- PROMPT OUTPUT -->
  <div class="prompt-container">
    <h2 class="section-title">üìù PROMPT G√âN√âR√â</h2>
    <textarea id="promptOutput" readonly placeholder="Votre prompt appara√Ætra ici..."></textarea>
  </div>
   <!-- TUTORIEL -->
  <div class="section" id="tutorialSection" style="display: none; margin-top: 40px;">
    <h2 class="section-title">üéì GUIDE RAPIDE - COMMENT UTILISER CE G√âN√âRATEUR</h2>
    
    <div class="tutorial-step">
      <h3>üé≠ √âTAPE 1 : Choisissez une personnalit√©</h3>
      <p>Cliquez sur une carte ou s√©lectionnez dans la liste d√©roulante. Vous pouvez aussi cr√©er une personnalit√© personnalis√©e.</p>
    </div>
    
    <div class="tutorial-step">
      <h3>üé¨ √âTAPE 2 : D√©finissez l'action et le lieu</h3>
      <p>Que fait votre personnage ? O√π se trouve-t-il ? Ces √©l√©ments cr√©ent le contexte de votre image.</p>
    </div>
    
    <div class="tutorial-step">
      <h3>üé® √âTAPE 3 : Personnalisez le style artistique</h3>
      <p>Style, √©clairage, composition et couleurs - ces param√®tres d√©finissent l'ambiance visuelle.</p>
    </div>
    
    <div class="tutorial-step">
      <h3>ü§ñ √âTAPE 4 : Configurez le moteur d'IA</h3>
      <p>S√©lectionnez le moteur cible (Midjourney, Stable Diffusion, DALL-E, etc.) pour optimiser le prompt.</p>
    </div>
    
    <div class="tutorial-step">
      <h3>üöÄ √âTAPE 5 : G√©n√©rez et utilisez</h3>
      <p>Cliquez sur "G√âN√âRER" pour cr√©er le prompt, puis "COPIER" pour l'utiliser dans votre moteur d'IA pr√©f√©r√©.</p>
    </div>
    
    <div style="text-align: center; margin-top: 30px;">
      <button onclick="toggleTutorial()" style="padding: 12px 30px; font-size: 16px; background: linear-gradient(135deg, #9d4edd, #560bad); color: white; border: none; border-radius: 10px; cursor: pointer;">
        ‚ùå Fermer le guide
      </button>
    </div>
  </div>
</div> <!-- Fin du .container -->

<!-- COMPTEUR -->
<div class="counter" id="counter" title="Nombre de prompts g√©n√©r√©s">0</div> 

<script>
// DONN√âES COMPL√àTES AVEC TOUTES LES VALEURS
const data = {
  // 75 PERSONNALIT√âS COMPL√àTES
  personalities: [
    // CHANTEURS (15)
    {name: "Freddie Mercury", category: "Chanteur"},
    {name: "Beyonc√©", category: "Chanteuse"},
    {name: "Michael Jackson", category: "Chanteur"},
    {name: "David Bowie", category: "Chanteur"},
    {name: "Madonna", category: "Chanteuse"},
    {name: "Elvis Presley", category: "Chanteur"},
    {name: "Lady Gaga", category: "Chanteuse"},
    {name: "Bob Marley", category: "Chanteur"},
    {name: "Amy Winehouse", category: "Chanteuse"},
    {name: "Elton John", category: "Chanteur"},
    {name: "Adele", category: "Chanteuse"},
    {name: "Prince", category: "Chanteur"},
    {name: "Taylor Swift", category: "Chanteuse"},
    {name: "Frank Sinatra", category: "Chanteur"},
    {name: "Shakira", category: "Chanteuse"},
    
    // ACTEURS (15)
    {name: "Marilyn Monroe", category: "Actrice"},
    {name: "Leonardo DiCaprio", category: "Acteur"},
    {name: "Meryl Streep", category: "Actrice"},
    {name: "Brad Pitt", category: "Acteur"},
    {name: "Audrey Hepburn", category: "Actrice"},
    {name: "Robert De Niro", category: "Acteur"},
    {name: "Scarlett Johansson", category: "Actrice"},
    {name: "Tom Hanks", category: "Acteur"},
    {name: "Angelina Jolie", category: "Actrice"},
    {name: "Johnny Depp", category: "Acteur"},
    {name: "Emma Watson", category: "Actrice"},
    {name: "Denzel Washington", category: "Acteur"},
    {name: "Natalie Portman", category: "Actrice"},
    {name: "Keanu Reeves", category: "Acteur"},
    {name: "Jennifer Lawrence", category: "Actrice"},
    
    // SPORTIFS (15)
    {name: "Michael Jordan", category: "Sportif"},
    {name: "Serena Williams", category: "Sportive"},
    {name: "Cristiano Ronaldo", category: "Sportif"},
    {name: "Simone Biles", category: "Sportive"},
    {name: "LeBron James", category: "Sportif"},
    {name: "Megan Rapinoe", category: "Sportive"},
    {name: "Lionel Messi", category: "Sportif"},
    {name: "Naomi Osaka", category: "Sportive"},
    {name: "Usain Bolt", category: "Sportif"},
    {name: "Rafael Nadal", category: "Sportif"},
    {name: "Katie Ledecky", category: "Sportive"},
    {name: "Tom Brady", category: "Sportif"},
    {name: "Simone Manuel", category: "Sportive"},
    {name: "Stephen Curry", category: "Sportif"},
    {name: "Alex Morgan", category: "Sportive"},
    
    // SUPERH√âROS (10)
    {name: "Superman", category: "Superh√©ros"},
    {name: "Wonder Woman", category: "Superh√©ro√Øne"},
    {name: "Batman", category: "Superh√©ros"},
    {name: "Spider-Man", category: "Superh√©ros"},
    {name: "Black Panther", category: "Superh√©ros"},
    {name: "Captain America", category: "Superh√©ros"},
    {name: "Iron Man", category: "Superh√©ros"},
    {name: "Catwoman", category: "Superh√©ro√Øne"},
    {name: "The Flash", category: "Superh√©ros"},
    {name: "Storm", category: "Superh√©ro√Øne"},
    
    // CR√âATURES FANTASTIQUES (10)
    {name: "Un dragon", category: "Cr√©ature"},
    {name: "Une licorne", category: "Cr√©ature"},
    {name: "Un vampire", category: "Cr√©ature"},
    {name: "Un loup-garou", category: "Cr√©ature"},
    {name: "Un fant√¥me", category: "Cr√©ature"},
    {name: "Un alien", category: "Cr√©ature"},
    {name: "Un zombie", category: "Cr√©ature"},
    {name: "Un d√©mon", category: "Cr√©ature"},
    {name: "Un ange", category: "Cr√©ature"},
    {name: "Un robot", category: "Cr√©ature"},
    
    // H√âROS DESSINS ANIM√âS (10)
    {name: "Mickey Mouse", category: "Dessin anim√©"},
    {name: "Bugs Bunny", category: "Dessin anim√©"},
    {name: "SpongeBob", category: "Dessin anim√©"},
    {name: "Sonic", category: "Dessin anim√©"},
    {name: "Pikachu", category: "Dessin anim√©"},
    {name: "Homer Simpson", category: "Dessin anim√©"},
    {name: "Scooby-Doo", category: "Dessin anim√©"},
    {name: "Winnie l'Ourson", category: "Dessin anim√©"},
    {name: "Dora l'Exploratrice", category: "Dessin anim√©"},
    {name: "Rick Sanchez", category: "Dessin anim√©"}
  ],
  
  // ACTIONS - Version COMPL√àTE et LOGIQUE
actions: [
  // Actions avec compl√©ments int√©gr√©s
  "chante sur sc√®ne devant un public en liesse",
  "danse fr√©n√©tiquement dans une bo√Æte de nuit",
  "combat h√©ro√Øquement des ennemis invisibles",
  "parle en public lors d'une conf√©rence",
  "court √† toute vitesse dans une rue d√©serte",
  "vole gracieusement dans les airs",
  "nage avec √©l√©gance dans l'oc√©an",
  "joue de la guitare √©lectrique avec passion",
  "peint un chef-d'≈ìuvre sur une toile g√©ante",
  "√©crit un roman sur un vieil ordinateur",
  "cuisine un plat gastronomique avec soin",
  "explore une plan√®te inconnue avec curiosit√©",
  "enseigne √† des √©l√®ves attentifs",
  "dirige une r√©union d'√©quipe avec autorit√©",
  "m√©dite paisiblement dans un jardin zen",
  "rit aux √©clats avec des amis",
  "pleure silencieusement dans son coin",
  "observe attentivement un ph√©nom√®ne √©trange",
  "construit une machine complexe",
  "d√©truit un vieux b√¢timent √† la pelle m√©canique",
  "sauve un chat coinc√© dans un arbre",
  "vole un diamant dans un mus√©e",
  "triche aux cartes avec malice",
  "gagne une comp√©tition sportive",
  "perd un match important",
  "tombe amoureux d'une inconnue",
  "se bat au sabre laser",
  "n√©gocie un trait√© de paix",
  "d√©couvre un tr√©sor enfoui",
  "cache un secret de famille",
  "transforme une citrouille en carrosse",
  "t√©l√©porte dans une autre dimension",
  "grandit jusqu'√† atteindre la taille d'un g√©ant",
  "r√©tr√©cit jusqu'√† devenir minuscule",
  "dispara√Æt myst√©rieusement sans laisser de traces",
  "r√©appara√Æt dans une explosion de lumi√®re"
],
  
      // LIEUX - Version FRAN√áAISE et COH√âRENTE
  lieux: [
    // Lieux r√©els
    "Times Square √† New York",
    "au pied de la tour Eiffel √† Paris",
    "dans le Colis√©e de Rome",
    "sur la Grande Muraille de Chine",
    "devant les pyramides de Gizeh",
    "au Machu Picchu au P√©rou",
    "dans les canaux de Venise",
    "sur la plage de Copacabana √† Rio",
    "au Mont-Saint-Michel",
    "dans le ch√¢teau de Versailles",
    "au carrefour de Shibuya √† Tokyo",
    "√† l'op√©ra de Sydney",
    "dans le Grand Canyon en Arizona",
    "aux chutes du Niagara",
    "au Taj Mahal en Inde",
    "devant Notre-Dame de Paris",
    
    // Lieux imaginaires
    "dans la station spatiale internationale",
    "dans la ville sous-marine de l'Atlantide",
    "dans une for√™t enchant√©e",
    "dans un ch√¢teau dans les nuages",
    "dans une ville cyberpunk aux n√©ons fluorescents",
    "sur une base lunaire",
    "√† bord d'un vaisseau spatial",
    "dans une dimension parall√®le",
    "dans une biblioth√®que infinie",
    "dans le jardin des d√©lices",
    "dans un laboratoire secret",
    "dans un temple antique",
    "sur un volcan en √©ruption",
    "au fond de l'oc√©an",
    "dans le d√©sert du Sahara",
    "dans la jungle amazonienne",
    
    // Lieux quotidiens (CORRIG√âS : on enl√®ve les pr√©positions car elles seront ajout√©es automatiquement)
    "le m√©tro parisien",
    "un supermarch√©",
    "la terrasse d'un caf√©",
    "une biblioth√®que",
    "une salle de classe",
    "une gare",
    "un centre commercial",
    "un parc public"
  ],
  
  // STYLES ARTISTIQUES
  styles: [
    "r√©aliste photographique", "hyperr√©aliste 8K", "photo magazine glossy", 
    "noir et blanc contrast√©", "s√©pia vintage", "couleurs satur√©es pop",
    "cin√©matographique √©pique", "film Hollywood", "film noir 1940s", "film Wes Anderson",
    "film Tim Burton", "animation Disney", "anime japonais", "style Ghibli",
    "cartoon Pixar", "BD franco-belge", "manga", "peinture √† l'huile",
    "aquarelle douce", "croquis crayon", "encre de Chine", "pastels tendres",
    "impressionniste Monet", "cubiste Picasso", "surr√©aliste Dal√≠", "pop art Warhol",
    "art nouveau Mucha", "art d√©co", "cyberpunk n√©on", "steampunk",
    "vaporwave 80s", "pixel art 8-bit", "low poly", "graffiti urbain",
    "glitch art", "fractal art", "minimaliste japonais", "flat design"
  ],
  
  // √âCLAIRAGES & AMBIANCES
  eclairages: [
    "soleil couchant dor√©", "aurore ros√©e douce", "midi soleil √©clatant",
    "lune pleine argent√©e", "ciel √©toil√© voie lact√©e", "aurore bor√©ale verte",
    "n√©ons bleu orange futuriste", "feux d'artifice multicolore", "bougies chaleureuses",
    "lasers discoth√®que", "lumi√®res noires UV", "√©clairage fluorescent",
    "LED RGB color√©es", "brume matinale", "√©clair orage", "arc-en-ciel",
    "teintes pastel douces", "monochrome s√©pia", "gradient violet-orange",
    "palette terre naturelle", "effet cin√©matique teal/orange", "contraste √©lev√© dramatique",
    "clair-obscur", "ombres profondes", "luminescence douce", "pluie r√©fl√©chissante n√©on",
    "brouillard mystique", "neige tombante", "poussi√®re d'√©toiles", "particules lumineuses"
  ]
};

// VARIABLES GLOBALES
let promptCount = 0;
let selectedPersonality = null;
let tutorialActive = false;
let tutorialStep = 1;
let characters = [];
let profiles = {};

// INITIALISATION
document.addEventListener('DOMContentLoaded', function() {
  initPersonalities();
  initActions();
  initLieux();
  initStyles();
  initEclairages();
  initColorPalette();
  initComposition();
  initPresets();
  loadSavedProfiles();
  updateAnalysis();
  
  // √âcouteurs d'√©v√©nements
  document.getElementById('promptOutput').addEventListener('input', updateAnalysis);
  document.querySelectorAll('select, input, textarea').forEach(el => {
    el.addEventListener('change', updateAnalysis);
    el.addEventListener('input', updateAnalysis);
  });
});

// FONCTIONS D'INITIALISATION
function initPersonalities() {
  const grid = document.getElementById('personalitiesGrid');
  const select = document.getElementById('personalitySelect');
  
  data.personalities.forEach((person, index) => {
    const card = document.createElement('div');
    card.className = 'personality-card';
    card.dataset.id = index;
    card.innerHTML = `<strong>${person.name}</strong><div class="personality-category">${person.category}</div>`;
    card.onclick = () => selectPersonalityCard(index);
    grid.appendChild(card);
    
    const option = document.createElement('option');
    option.value = index;
    option.textContent = `${person.name} (${person.category})`;
    select.appendChild(option);
  });
}

function initActions() {
  const select = document.getElementById('action');
  data.actions.forEach(action => {
    const option = document.createElement('option');
    option.value = action;
    option.textContent = action;
    select.appendChild(option);
  });
}

function initLieux() {
  const select = document.getElementById('lieu');
  data.lieux.forEach(lieu => {
    const option = document.createElement('option');
    option.value = lieu;
    option.textContent = lieu;
    select.appendChild(option);
  });
}

function initStyles() {
  const select = document.getElementById('style');
  data.styles.forEach(style => {
    const option = document.createElement('option');
    option.value = style;
    option.textContent = style;
    select.appendChild(option);
  });
}

function initEclairages() {
  const select = document.getElementById('eclairage');
  data.eclairages.forEach(eclairage => {
    const option = document.createElement('option');
    option.value = eclairage;
    option.textContent = eclairage;
    select.appendChild(option);
  });
}

function initColorPalette() {
  updateColorPalette();
}

function initComposition() {
  const compositions = [
    {name: "R√®gle des tiers", desc: "√âquilibre parfait"},
    {name: "Sym√©trie centrale", desc: "Harmonie visuelle"},
    {name: "Contre-plong√©e", desc: "H√©ro√Øque"},
    {name: "Plong√©e", desc: "Vuln√©rable"},
    {name: "Gros plan", desc: "√âmotions"},
    {name: "Plan large", desc: "√âpique"}
  ];
  
  const grid = document.getElementById('compositionGrid');
  compositions.forEach(comp => {
    const item = document.createElement('div');
    item.className = 'composition-item';
    item.innerHTML = `<strong>${comp.name}</strong><br><small>${comp.desc}</small>`;
    item.onclick = () => applyComposition(comp.name);
    grid.appendChild(item);
  });
}

function initPresets() {
  const presets = [
    {name: "Fantasy", icon: "üêâ"},
    {name: "Cyberpunk", icon: "üîÆ"},
    {name: "Portrait", icon: "üë§"},
    {name: "Paysage", icon: "üèûÔ∏è"},
    {name: "Sci-Fi", icon: "üöÄ"}
  ];
  
  const container = document.getElementById('presetButtons');
  presets.forEach(preset => {
    const btn = document.createElement('button');
    btn.className = 'profile-button';
    btn.innerHTML = `${preset.icon} ${preset.name}`;
    btn.onclick = () => loadPreset(preset.name.toLowerCase());
    container.appendChild(btn);
  });
}

// FONCTION pour nettoyer et formater le texte
function formatFrenchText(text) {
  if (!text) return '';
  
  let formatted = text;
  
  const corrections = [
    // Articles manquants
    { regex: /dans station/g, replace: 'dans la station' },
    { regex: /dans ville/g, replace: 'dans une ville' },
    { regex: /dans vaisseau/g, replace: 'dans un vaisseau' },
    { regex: /dans for√™t/g, replace: 'dans une for√™t' },
    { regex: /dans ch√¢teau/g, replace: 'dans un ch√¢teau' },
    { regex: /dans temple/g, replace: 'dans un temple' },
    
    // Majuscules inutiles
    { regex: /\b(Station|Spatiale|Vaisseau|Ville|For√™t|Ch√¢teau|Temple)\b/g, 
      replace: (match) => match.toLowerCase() },

    // Corrige les pr√©positions doubles
    { regex: /dans sur /g, replace: 'sur ' },
    { regex: /dans √† /g, replace: '√† ' },
    { regex: /dans au /g, replace: 'au ' },
    { regex: /dans aux /g, replace: 'aux ' },
    { regex: /dans en /g, replace: 'en ' },
    { regex: /dans dans /g, replace: 'dans ' },
    
    // Composition avec accents
    { regex: /\bsymetrie\b/gi, replace: 'sym√©trie' },
    { regex: /\bregle-des-tiers\b/gi, replace: 'r√®gle des tiers' },
    { regex: /\blignes-directrices\b/gi, replace: 'lignes directrices' },
    { regex: /\bcadre-dans-le-cadre\b/gi, replace: 'cadre dans le cadre' },
    
    // Format
    { regex: /cadrage carr√©/gi, replace: 'carr√©' },
    { regex: /plan large/gi, replace: 'cadrage large' },
    
    // Majuscules inutiles
    { regex: /\b(For√™t|Ch√¢teau|Temple|Ville|Station|Biblioth√®que|Laboratoire|Jardin|Volcan|D√©sert|Jungle)\b/g,
      replace: (match) => match.toLowerCase() },
    
    // Corrige "format format" -> "format"
    { regex: /format format/g, replace: 'format' }
  ];
  
  corrections.forEach(correction => {
    formatted = formatted.replace(correction.regex, correction.replace);
  });
  
  return formatted;
}

function capitalizeSentences(text) {
  // Divise le texte en phrases (s√©par√©es par un point suivi d'un espace)
  return text.split('. ').map(sentence => {
    if (sentence.length === 0) return sentence;
    // Capitalise la premi√®re lettre de la phrase
    return sentence.charAt(0).toUpperCase() + sentence.slice(1);
  }).join('. ');
}

function commenceParPreposition(lieu) {
  if (!lieu) return false;
  const prepositions = ['dans ', 'sur ', '√† ', 'au ', 'aux ', 'en ', 'sous ', 'devant ', 'derri√®re ', 'pr√®s de ', 'loin de ', '√† bord d\'', 'au pied de ', '√† l\'', 'aux ', 'devant ', 'chez '];
  return prepositions.some(prep => lieu.toLowerCase().startsWith(prep));
}

// FONCTIONS PRINCIPALES
function generatePrompt() {
  // R√©cup√©ration des valeurs
  const personality = getSelectedValue('customPersonality', 'personalitySelect', data.personalities);
  const action = getSelectedValue('customAction', 'action', data.actions);
  const lieu = getSelectedValue('customLieu', 'lieu', data.lieux);
  const style = getSelectedValue('customStyle', 'style', data.styles);
  const eclairage = getSelectedValue('customEclairage', 'eclairage', data.eclairages);
  const genre = document.getElementById('genre').value;
  const format = document.getElementById('format').value;
  const composition = document.getElementById('compositionType').value;
  const colors = document.getElementById('customColors').value;

  // Construction structur√©e du prompt
  let promptParts = [];
  
  // 1. SUJET PRINCIPAL
let sujet = [];
if (personality) {
  // NE PAS ajouter le genre automatiquement
  sujet.push(personality);
}
  
  if (action) {
    if (sujet.length > 0) {
      promptParts.push(`${sujet.join(' ')} ${action}`);
    } else {
      promptParts.push(action);
    }
  } else if (sujet.length > 0) {
    promptParts.push(sujet.join(' '));
  }
  
  // 2. CONTEXTE (lieu) - VERSION CORRIG√âE
  let contexte = [];
  if (lieu) {
    if (commenceParPreposition(lieu)) {
      contexte.push(lieu);
    } else {
      contexte.push(`dans ${lieu}`);
    }
  }
  
  if (contexte.length > 0) {
    if (promptParts.length > 0) {
      promptParts[promptParts.length - 1] += ` ${contexte.join(', ')}`;
    } else {
      promptParts.push(contexte.join(', '));
    }
  }
  
  // 3. STYLE ARTISTIQUE
  let styleSection = [];
  if (style) styleSection.push(style);
  if (eclairage) styleSection.push(`√©clairage ${eclairage}`);
  if (composition) styleSection.push(`composition ${composition}`);
  if (colors) styleSection.push(`palette de couleurs ${colors}`);

  // Ajout des d√©tails sp√©cifiques au th√®me (pour randomAll seulement)
  const currentTheme = getCurrentTheme(); // Nous allons cr√©er cette fonction
  if (currentTheme && currentTheme.details) {
    styleSection.push(currentTheme.details);
  }
  
  if (styleSection.length > 0) {
    promptParts.push(styleSection.join(', '));
  }
  
  // 4. TECHNIQUE
  let technique = [];
  if (format) technique.push(`format ${format}`);
  
  if (technique.length > 0) {
    promptParts.push(technique.join(', '));
  }
  
  // Modes cr√©atifs
  if (document.getElementById('modeAnachronique').checked) {
    promptParts.push("anachronisme cr√©atif");
  }
  if (document.getElementById('modeSurrealiste').checked) {
    promptParts.push("touche surr√©aliste");
  }
  
  // Assemblage final
  let finalPrompt = "";
  
  for (let i = 0; i < promptParts.length; i++) {
    const part = promptParts[i].trim();
    if (!part) continue;
    
    if (i === 0) {
      finalPrompt += part.charAt(0).toUpperCase() + part.slice(1);
    } else {
      finalPrompt += part;
    }
    
    if (i < promptParts.length - 1) {
      if (!part.endsWith('.') && !part.endsWith('!') && !part.endsWith('?')) {
        if (part.length > 40 || part.includes(',')) {
          finalPrompt += '. ';
        } else {
          finalPrompt += ', ';
        }
      } else {
        finalPrompt += ' ';
      }
    } else {
      if (!part.endsWith('.') && !part.endsWith('!') && !part.endsWith('?')) {
        finalPrompt += '.';
      }
    }
  }

      finalPrompt = formatFrenchText(finalPrompt);
  finalPrompt = capitalizeSentences(finalPrompt);
 
  // Formatage pour le moteur d'IA
  const engine = document.getElementById('aiEngine').value;
  finalPrompt = formatForEngine(finalPrompt, engine);
  
  // Affichage
  promptCount++;
  updateCounter();
  document.getElementById('promptOutput').value = `#${promptCount} ${finalPrompt}`;
  
  // Copie automatique
  if (document.getElementById('autoCopy').checked) {
    copyPrompt();
  }
  
  // Mise √† jour de l'analyse
  updateAnalysis();
  
  showNotification(`‚úÖ Prompt #${promptCount} g√©n√©r√© !`, '#00ff88');
}

function formatForEngine(prompt, engine) {
  switch(engine) {
    case 'midjourney':
      return prompt + ' --style raw --v 5.2';
    case 'stable-diffusion':
      return prompt;
    case 'dall-e':
      // Capitaliser pour DALL-E
      return prompt.charAt(0).toUpperCase() + prompt.slice(1) + '.';
    case 'leonardo':
      return prompt + ' [Leonardo Diffusion XL]';
    default:
      return prompt;
  }
}

function copyPrompt() {
  const prompt = document.getElementById('promptOutput').value;
  navigator.clipboard.writeText(prompt).then(() => {
    showNotification('üìã Prompt copi√© !', '#00d4ff');
  });
}

function randomizeAll() {
  // 1. D√âFINIR 4 TH√àMES COH√âRENTS
  const coherentThemes = [
    {
      name: "cyberpunk",
      personality: ["David Bowie", "Keanu Reeves", "Lady Gaga"],
      action: [
        "combat h√©ro√Øquement des andro√Ødes rebelles avec des lasers et des sabres d'√©nergie", 
        "hacke un syst√®me de s√©curit√© complexe avec des interfaces holographiques brillantes", 
        "vole une puce neuronale rare sur le march√© noir high-tech"
      ],
      lieu: [
        "une ville cyberpunk immense avec des n√©ons fluorescents et des gratte-ciel holographiques", 
        "la station spatiale ISS en orbite autour de la Terre avec vue sur la plan√®te bleue", 
        "un vaisseau spatial futuriste traversant une n√©buleuse color√©e"
      ],
      style: "cyberpunk n√©on, d√©taill√©, 8K, art conceptuel",
      eclairage: "n√©ons bleu et orange, contrastes forts, lumi√®res artificielles",
      colors: "neon",
      composition: "r√®gle des tiers",
      details: "d√©tails complexes, textures riches, m√©tal poliss√©, circuits luminescens, interfaces holographiques, reflets sur surfaces mouill√©es, architecture n√©o-tokyo, vapeurs industrielles",
      format: ["plan large cin√©matographique 16:9", "plan large ultra-large 21:9", "panoramique 3:1"]
    },
    {
      name: "fantasy",
      personality: ["Un dragon", "Une licorne", "Un vampire", "Un ange"],
      action: [
        "vole gracieusement avec ses ailes majestueuses d√©ploy√©es",
        "prot√®ge un tr√©sor antique",
        "jette un sort puissant qui illumine le ciel nocturne d'√©clairs color√©s et magiques"
      ],
      lieu: [
        "dans une for√™t enchant√©e myst√©rieuse peupl√©e de cr√©atures magiques et d'arbres luminescents", 
        "dans un ch√¢teau m√©di√©val majestueux perch√© sur une montagne entour√©e de nuages", 
        "dans un temple antique mystique recouvert de lianes et de mousse, au milieu d'une jungle dense"
      ],
      style: "peinture √† l'huile, style baroque, riche en d√©tails, fantastique",
      eclairage: "brume matinale √©paisse, rayons de soleil per√ßant les nuages, ambiance mystique",
      colors: "warm",
      composition: "sym√©trie",
      details: "d√©tails complexes, textures riches, √©cailles iridescentes, fourrure soyeuse, plumes d√©taill√©es, armures orn√©es, pierreries brillantes, v√©g√©tation luxuriante, lumi√®res magiques",
      format: ["plan large cin√©matographique 16:9", "panoramique 3:1", "IMAX 1.43:1"]
    },
    {
      name: "r√©aliste-int√©rieur",
      personality: ["Leonardo DiCaprio", "Meryl Streep", "Brad Pitt", "Angelina Jolie"],
      action: [
        "enseigne avec dynamisme √† des √©l√®ves attentifs",
        "dirige avec autorit√© une r√©union d'√©quipe importante",
        "parle avec passion en public lors d'une conf√©rence"
      ],
      lieu: [
        "dans une salle de classe spacieuse et lumineuse avec de grandes fen√™tres", 
        "dans un bureau moderne avec une d√©coration √©pur√©e",
        "dans un amphith√©√¢tre historique impressionnant aux si√®ges en bois et √† l'acoustique parfaite"
      ],
      style: "r√©aliste photographique, haute r√©solution 8K, d√©tails pr√©cis",
      eclairage: "lumi√®re naturelle diffuse, ombres douces, √©clairage int√©rieur chaleureux",
      colors: "cool",
      composition: "lignes directrices",
      details: "d√©tails complexes, textures de peau r√©alistes, expressions faciales subtiles, v√™tements avec plis naturels, reflets dans les yeux, pores de la peau visibles, cheveux d√©taill√©s",
      format: ["portrait 9:16", "cadrage carr√© 1:1", "plan large cin√©matographique 16:9"]
    },
    {
      name: "r√©aliste-ext√©rieur",
      personality: ["Leonardo DiCaprio", "Meryl Streep", "Brad Pitt", "Angelina Jolie"],
      action: [
        "se prom√®ne avec une expression pensive",
        "donne une interview en plein air",
        "participe √† un √©v√©nement culturel"
      ],
      lieu: [
        "sur la terrasse d'un caf√© parisien anim√© avec vue sur les rues pittoresques", 
        "devant un monument historique c√©l√®bre avec l'architecture en arri√®re-plan",
        "dans un parc urbain verdoyant avec des bancs et des passants"
      ],
      style: "r√©aliste photographique, haute r√©solution 8K, d√©tails pr√©cis",
      eclairage: "soleil couchant dor√©, ombres allong√©es, lumi√®re naturelle",
      colors: "cool",
      composition: "regle-des-tiers",
      details: "d√©tails complexes, textures de peau r√©alistes, expressions faciales subtiles, v√™tements avec plis naturels, cheveux d√©taill√©s, environnement r√©aliste",
      format: ["plan large cin√©matographique 16:9", "plan large ultra-large 21:9", "cadrage carr√© 1:1"]
    }
  ];

  // 2. CHOISIR UN TH√àME AU HASARD
  const theme = coherentThemes[Math.floor(Math.random() * coherentThemes.length)];
  
  // 3. APPLIQUER LE TH√àME CHOISI
  
  // 3a. Personnalit√© (dans le champ personnalis√©, vider le select)
  const randomPerson = theme.personality[Math.floor(Math.random() * theme.personality.length)];
  document.getElementById('customPersonality').value = randomPerson;
  document.getElementById('personalitySelect').value = '';
  
  // 3b. Action (dans le champ personnalis√©, vider le select)
  const randomAction = theme.action[Math.floor(Math.random() * theme.action.length)];
  document.getElementById('customAction').value = randomAction;
  document.getElementById('action').value = '';
  
  // 3c. Lieu (dans le champ personnalis√©, vider le select)
  const randomLieu = theme.lieu[Math.floor(Math.random() * theme.lieu.length)];
  document.getElementById('customLieu').value = randomLieu;
  document.getElementById('lieu').value = '';
  
  // 3d. Style (dans le select, vider le champ personnalis√©)
  document.getElementById('style').value = theme.style;
  document.getElementById('customStyle').value = '';
  
  // 3e. √âclairage (dans le select, vider le champ personnalis√©)
  document.getElementById('eclairage').value = theme.eclairage;
  document.getElementById('customEclairage').value = '';
  
  // 3f. Couleurs (dans le select, vider le champ personnalis√©)
  document.getElementById('colorTheme').value = theme.colors;
  updateColorPalette();
  document.getElementById('customColors').value = '';
  
  // 3g. Composition (dans le select)
  document.getElementById('compositionType').value = theme.composition;
  
  // 3h. Format coh√©rent avec le th√®me
  const randomFormat = theme.format[Math.floor(Math.random() * theme.format.length)];
  document.getElementById('format').value = randomFormat;
  
  // 3i. Genre - LAISS√â VIDE (pas de mention de genre pour √©viter les incoh√©rences)
document.getElementById('genre').value = '';
  
  // 4. G√âN√âRER LE PROMPT
  setTimeout(() => generatePrompt(), 100);
  
  // 5. NOTIFICATION
  showNotification(`üé≤ Th√®me ${theme.name.toUpperCase()} appliqu√© !`, '#00d4ff');
}
  

function clearAll() {
  document.querySelectorAll('select').forEach(select => {
    select.selectedIndex = 0;
  });
  
  document.querySelectorAll('.custom-input').forEach(input => {
    input.value = '';
  });
  
  document.getElementById('promptOutput').value = '';
  promptCount = 0;
  updateCounter();
  
  // R√©initialiser les personnages
  characters = [];
  updateCharactersUI();
  
  showNotification('üßπ Tout effac√© !', '#4ecdc4');
}

// SYST√àME DE PROFILS
function saveProfile() {
  const name = document.getElementById('profileName').value.trim();
  if (!name) {
    showNotification('‚ùå Veuillez donner un nom au profil', '#ff6b6b');
    return;
  }
  
  // Sauvegarder toutes les valeurs
  const profile = {
    name: name,
    values: {}
  };
  
  // Collecter toutes les valeurs
  document.querySelectorAll('select, input, textarea').forEach(el => {
    if (el.id && !el.id.includes('Output')) {
      profile.values[el.id] = el.value;
    }
  });
  
  // Sauvegarder dans localStorage
  profiles[name] = profile;
  localStorage.setItem('promptProfiles', JSON.stringify(profiles));
  
  // Mettre √† jour la liste
  updateProfilesList();
  showNotification(`üíæ Profil "${name}" sauvegard√© !`, '#00ff88');
}

function loadProfile() {
  const name = document.getElementById('profilesList').value;
  if (!name || !profiles[name]) return;
  
  const profile = profiles[name];
  
  // Restaurer toutes les valeurs
  Object.keys(profile.values).forEach(id => {
    const element = document.getElementById(id);
    if (element) {
      element.value = profile.values[id];
    }
  });
  
  showNotification(`üìÇ Profil "${name}" charg√© !`, '#00d4ff');
}

function deleteProfile() {
  const name = document.getElementById('profilesList').value;
  if (!name) return;
  
  delete profiles[name];
  localStorage.setItem('promptProfiles', JSON.stringify(profiles));
  updateProfilesList();
  showNotification(`üóëÔ∏è Profil "${name}" supprim√© !`, '#ff6b6b');
}

function resetProfiles() {
  if (confirm('Voulez-vous vraiment supprimer tous les profils ?')) {
    profiles = {};
    localStorage.removeItem('promptProfiles');
    updateProfilesList();
    showNotification('üîÑ Tous les profils ont √©t√© supprim√©s', '#ffa500');
  }
}

function loadSavedProfiles() {
  const saved = localStorage.getItem('promptProfiles');
  if (saved) {
    profiles = JSON.parse(saved);
    updateProfilesList();
  }
}

function updateProfilesList() {
  const select = document.getElementById('profilesList');
  select.innerHTML = '<option value="">-- Choisir un profil --</option>';
  
  Object.keys(profiles).forEach(name => {
    const option = document.createElement('option');
    option.value = name;
    option.textContent = name;
    select.appendChild(option);
  });
}

// PALETTES DE COULEURS
function updateColorPalette() {
  const theme = document.getElementById('colorTheme').value;
  const palette = getColorPalette(theme);
  const container = document.getElementById('colorPalette');
  container.innerHTML = '';
  
  palette.forEach(color => {
    const swatch = document.createElement('div');
    swatch.className = 'color-swatch';
    swatch.style.background = color;
    swatch.title = color;
    swatch.onclick = () => applyColor(color);
    container.appendChild(swatch);
  });
}

function getColorPalette(theme) {
  const palettes = {
    warm: ['#FF6B6B', '#FFA726', '#FFEE58', '#FF8A65', '#D84315'],
    cool: ['#00D4FF', '#4ECDC4', '#81D4FA', '#29B6F6', '#0288D1'],
    pastel: ['#FFCDD2', '#F8BBD0', '#E1BEE7', '#C5CAE9', '#B3E5FC'],
    neon: ['#FF00FF', '#00FF00', '#00FFFF', '#FFFF00', '#FF00FF'],
    monochrome: ['#333333', '#666666', '#999999', '#CCCCCC', '#FFFFFF']
  };
  
  return palettes[theme] || palettes.warm;
}

function applyColor(color) {
  document.getElementById('customColors').value = color;
}

// COMPOSITION
function applyComposition(type) {
  document.getElementById('compositionType').value = type.toLowerCase().replace(/\s+/g, '-');
}

// MULTI-PERSONNAGES
function addCharacter() {
  characters.push({
    name: `Personnage ${characters.length + 1}`,
    role: '',
    relation: ''
  });
  updateCharactersUI();
}

function updateCharactersUI() {
  const container = document.getElementById('charactersContainer');
  container.innerHTML = '';
  
  characters.forEach((char, index) => {
    const section = document.createElement('div');
    section.className = 'character-section';
    section.innerHTML = `
      <h4>${char.name}</h4>
      <div class="input-group">
        <input type="text" placeholder="Nom" value="${char.name}" onchange="updateCharacter(${index}, 'name', this.value)">
      </div>
      <div class="input-group">
        <input type="text" placeholder="R√¥le" value="${char.role}" onchange="updateCharacter(${index}, 'role', this.value)">
      </div>
      <div class="input-group">
        <input type="text" placeholder="Relation" value="${char.relation}" onchange="updateCharacter(${index}, 'relation', this.value)">
      </div>
      <button class="remove-character" onclick="removeCharacter(${index})">Supprimer</button>
    `;
    container.appendChild(section);
  });
}

function updateCharacter(index, field, value) {
  characters[index][field] = value;
}

function removeCharacter(index) {
  characters.splice(index, 1);
  updateCharactersUI();
}

// TUTORIEL
function toggleTutorial() {
  // Petite notification pour confirmer l'ouverture
  if (!document.getElementById('tutorialSection').style.display || 
      document.getElementById('tutorialSection').style.display === 'none') {
    showNotification('üìö Tutoriel ouvert !', '#9d4edd');
  }
  const tutorialSection = document.getElementById('tutorialSection');
  const tutorialToggle = document.getElementById('tutorialToggle');
  
  if (tutorialSection.style.display === 'none' || tutorialSection.style.display === '') {
    tutorialSection.style.display = 'block';
    tutorialToggle.innerHTML = '<span>‚ùå</span> FERMER';
    tutorialToggle.style.background = 'linear-gradient(135deg, #ff6b6b, #ff8e8e)';
  } else {
    tutorialSection.style.display = 'none';
    tutorialToggle.innerHTML = '<span>üéì</span> TUTORIEL';
    tutorialToggle.style.background = '';
  }
}

// ANALYSE
function updateAnalysis() {
  const prompt = document.getElementById('promptOutput').value;
  const cleanPrompt = prompt.replace(/^#\d+\s*/, '');
  const words = cleanPrompt.split(/\s+/).filter(word => word.length > 0).length;
  
  // Calcul des scores
  let detailScore = 'Faible';
  if (words > 50) detailScore = '√âlev√©';
  else if (words > 20) detailScore = 'Moyen';
  
  let complexityScore = 'Simple';
  if (words > 80) complexityScore = 'Complexe';
  else if (words > 40) complexityScore = 'Mod√©r√©';
  
  const quality = Math.min(100, words * 2);
  
  // Mise √† jour de l'interface
  document.getElementById('lengthScore').textContent = `${words} mots`;
  document.getElementById('detailScore').textContent = detailScore;
  document.getElementById('complexityScore').textContent = complexityScore;
  document.getElementById('qualityBar').style.width = `${quality}%`;
  
  // Conseils
  const tips = document.getElementById('analysisTips');
  if (words < 15) {
    tips.innerHTML = 'üí° Conseil : Ajoutez plus de d√©tails pour de meilleurs r√©sultats.';
  } else if (words > 100) {
    tips.innerHTML = 'üí° Conseil : Votre prompt est tr√®s long, certains √©l√©ments pourraient √™tre ignor√©s.';
  } else {
    tips.innerHTML = '‚úÖ Votre prompt est bien √©quilibr√©.';
  }
}

// FONCTIONS UTILITAIRES
function getSelectedValue(customId, selectId, dataArray) {
  const custom = document.getElementById(customId).value.trim();
  if (custom) return custom;
  
  const select = document.getElementById(selectId);
  if (select.value) {
    if (dataArray && selectId === 'personalitySelect') {
      return dataArray[select.value]?.name || select.value;
    }
    return select.value;
  }
  
  return '';
}


function selectPersonalityCard(index) {
  document.querySelectorAll('.personality-card').forEach(card => {
    card.classList.remove('selected');
  });
  
  const card = document.querySelector(`.personality-card[data-id="${index}"]`);
  if (card) {
    card.classList.add('selected');
  }
  
  document.getElementById('personalitySelect').value = index;
  document.getElementById('customPersonality').value = ''; // Vide le champ personnalis√©
  selectedPersonality = data.personalities[index];
}

function selectPersonality(value) {
  if (value === "") {
    document.querySelectorAll('.personality-card').forEach(card => {
      card.classList.remove('selected');
    });
    selectedPersonality = null;
    document.getElementById('customPersonality').value = ''; // Vide le champ personnalis√©
    return;
  }
  
  selectPersonalityCard(parseInt(value));
}

function updateCounter() {
  document.getElementById('promptCount').textContent = promptCount;
  document.getElementById('counter').textContent = promptCount;
}

function showNotification(message, color) {
  const notification = document.createElement('div');
  notification.textContent = message;
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${color};
    color: ${color === '#00ff88' ? '#000' : 'white'};
    padding: 15px 25px;
    border-radius: 10px;
    z-index: 10000;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
  `;
  
  document.body.appendChild(notification);
  setTimeout(() => notification.remove(), 3000);
}

// RACCOURCIS CLAVIER
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey && e.key === 'Enter') generatePrompt();
  if (e.ctrlKey && e.key === 'r') randomizeAll();
  if (e.ctrlKey && e.key === 'c') copyPrompt();
  if (e.ctrlKey && e.key === 'Delete') clearAll();
});

// Chargement des profils sauvegard√©s
function loadPreset(presetName) {
  // Exemple de configuration pour chaque preset
  const presets = {
    fantasy: {
      genre: "",
      format: "wide shot cin√©matique 16:9",
      style: "peinture √† l'huile baroque",
      eclairage: "soleil couchant dor√©"
    },
    cyberpunk: {
      genre: "",
      format: "wide shot ultra-large 21:9",
      style: "cyberpunk n√©on",
      eclairage: "n√©ons bleu orange futuriste"
    },
    portrait: {
      genre: "homme",
      format: "portrait 9:16",
      style: "r√©aliste photographique",
      eclairage: "clair-obscur"
    },
    paysage: {
      genre: "",
      format: "panoramique 3:1",
      style: "hyperr√©aliste 8K",
      eclairage: "aurore ros√©e douce"
    },
    "sci-fi": {
      genre: "",
      format: "wide shot cin√©matique 16:9",
      style: "science-fiction futuriste",
      eclairage: "lumi√®res noires UV"
    }
  };
  
  if (presets[presetName]) {
    const preset = presets[presetName];
    Object.keys(preset).forEach(key => {
      const element = document.getElementById(key);
      if (element) {
        element.value = preset[key];
      }
    });
    showNotification(`‚úÖ Preset "${presetName}" charg√© !`, '#9d4edd');
  }
}

function getCurrentTheme() {
  // V√©rifie si les valeurs actuelles correspondent √† un th√®me
  const personality = document.getElementById('customPersonality').value;
  const action = document.getElementById('customAction').value;
  const lieu = document.getElementById('customLieu').value;
  
  // Compare avec les th√®mes d√©finis dans randomizeAll()
  const themes = [
    {
      name: "cyberpunk",
      personalities: ["David Bowie", "Keanu Reeves", "Lady Gaga"],
      actions: ["combat h√©ro√Øquement des andro√Ødes rebelles", "hacke un syst√®me de s√©curit√© complexe", "vole une puce neuronale rare"],
      lieux: ["une ville cyberpunk immense", "la station spatiale ISS", "un vaisseau spatial futuriste"],
      details: "d√©tails complexes, textures riches, m√©tal poliss√©, circuits luminescents, interfaces holographiques"
    },
    {
      name: "fantasy", 
      personalities: ["Un dragon", "Une licorne", "Un vampire", "Un ange"],
      actions: ["vole gracieusement au-dessus d'une for√™t ancienne", "prot√®ge un tr√©sor antique", "jette un sort puissant"],
      lieux: ["une for√™t enchant√©e myst√©rieuse", "un ch√¢teau m√©di√©val majestueux", "un temple antique mystique"],
      details: "d√©tails complexes, textures riches, √©cailles iridescentes, fourrure soyeuse, plumes d√©taill√©es"
    },
    {
      name: "r√©aliste",
      personalities: ["Leonardo DiCaprio", "Meryl Streep", "Brad Pitt", "Angelina Jolie"],
      actions: ["parle avec passion en public", "enseigne avec dynamisme", "dirige avec autorit√©"],
      lieux: ["sur la terrasse d'un caf√© parisien", "dans une salle de classe spacieuse", "dans un amphith√©√¢tre historique"],
      details: "d√©tails complexes, textures de peau r√©alistes, expressions faciales subtiles"
    }
  ];
  
  for (const theme of themes) {
    const isPersonalityMatch = theme.personalities.some(p => personality.includes(p));
    const isActionMatch = theme.actions.some(a => action.includes(a));
    const isLieuMatch = theme.lieux.some(l => lieu.includes(l));
    
    if (isPersonalityMatch && (isActionMatch || isLieuMatch)) {
      return theme;
    }
  }
  
  return null;
}

function clearCustom(customId) {
  document.getElementById(customId).value = '';
}


</script>
</body>
</html>
