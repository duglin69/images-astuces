<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® G√©n√©rateur de Prompts Publicitaires Pro V3 - Avec Personnages</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 24px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        .header h1 {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(90deg, #ec4899 0%, #06b6d4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .header p {
            color: #94a3b8;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: #ec4899;
            color: white;
        }

        .btn-primary:hover {
            background: #db2777;
        }

        .btn-secondary {
            background: #475569;
            color: white;
        }

        .btn-secondary:hover {
            background: #334155;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .templates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .template-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            background: #334155;
            border-color: #ec4899;
        }

        .template-card h3 {
            color: #ec4899;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .template-card p {
            color: #94a3b8;
            font-size: 14px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 24px;
        }

        .card h2 {
            color: #ec4899;
            margin-bottom: 16px;
            font-size: 20px;
        }

        .card h2.cyan {
            color: #06b6d4;
        }

        .card h2.purple {
            color: #a855f7;
        }

        .card h2.orange {
            color: #f97316;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            color: #cbd5e1;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 6px;
            color: white;
            font-family: inherit;
            font-size: 14px;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #ec4899;
            background: #1e293b;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .dropdown-toggle {
            width: 100%;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #0f172a;
            border: 1px solid #334155;
            padding: 10px;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .dropdown-toggle:hover {
            border-color: #ec4899;
        }

        .dropdown-content {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 16px;
            max-height: 200px;
            overflow-y: auto;
        }

        .dropdown-content label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            margin-top: 0;
            font-weight: normal;
        }

        .characters-section {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .character-count-control {
            margin-bottom: 16px;
        }

        .character-count-control label {
            margin-bottom: 8px;
        }

        .character-count-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .character-count-btn {
            padding: 8px 16px;
            background: #334155;
            border: 2px solid #334155;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .character-count-btn.active {
            background: #ec4899;
            border-color: #ec4899;
        }

        .character-count-btn:hover {
            border-color: #ec4899;
        }

        .characters-list {
            display: grid;
            gap: 16px;
        }

        .character-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 16px;
        }

        .character-card h3 {
            color: #06b6d4;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .interactions-section {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            display: none;
        }

        .interactions-section.visible {
            display: block;
        }

        .output {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .output h2 {
            color: #ec4899;
            margin-bottom: 16px;
        }

        .prompt-box {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 16px;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.6;
            color: #e2e8f0;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-box h3 {
            color: #06b6d4;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .prompt-box h3.negative {
            color: #ef4444;
        }

        .history-item {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item-info {
            flex: 1;
        }

        .history-item-product {
            font-weight: 600;
            color: #cbd5e1;
        }

        .history-item-date {
            color: #64748b;
            font-size: 12px;
            margin-top: 4px;
        }

        .history-item-buttons {
            display: flex;
            gap: 8px;
        }

        .footer {
            text-align: center;
            color: #64748b;
            font-size: 14px;
            padding: 24px;
            border-top: 1px solid #334155;
        }

        .export-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }

            .main-grid {
                grid-template-columns: 1fr;
            }

            .templates {
                grid-template-columns: 1fr;
            }

            .character-grid {
                grid-template-columns: 1fr;
            }
        }
        .top-right {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
    z-index: 1000;
}

body {
    padding-top: 80px;
}
        .btn-retour {
    display: inline-block;
    padding: 12px 20px;
    background: #007BFF;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
}
    </style>
</head>
<body>
    <div class="top-right">
    <a href="index.html" class="btn-retour">üè† Accueil</a>
    <a href="repertoire/index.html" class="btn-retour">üìö R√©pertoire</a>
</div>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>‚ú® G√©n√©rateur de Prompts Publicitaires Pro V3</h1>
            <p>Cr√©ez des sc√®nes narratives avec personnages pour vos publicit√©s</p>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="btn-primary" onclick="changeLanguage('fr')">üá´üá∑ Fran√ßais</button>
            <button class="btn-secondary" onclick="changeLanguage('en')">üá¨üáß English</button>
            <button class="btn-secondary" onclick="toggleHistory()">üìú Historique (<span id="historyCount">0</span>)</button>
        </div>

        <!-- History Section -->
        <div id="historySection" style="display: none; margin-bottom: 32px;">
            <div class="card">
                <h2>üìú Mes Derniers Prompts</h2>
                <div id="historyList"></div>
            </div>
        </div>

        <!-- Templates Section -->
        <div class="card" style="margin-bottom: 32px;">
            <h2>üìã Templates Pr√©-configur√©s</h2>
            <div class="templates" id="templatesContainer"></div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Product Selection -->
            <div class="card">
                <h2>üì¶ Produit</h2>
                <div class="form-group">
                    <label for="category">Cat√©gorie</label>
                    <select id="category" onchange="updateProducts()">
                        <option value="clothing">üëï V√™tements</option>
                        <option value="shoes">üëü Chaussures</option>
                        <option value="accessories">üíç Accessoires</option>
                        <option value="beauty">üíÑ Beaut√©</option>
                        <option value="electronics">üì± √âlectronique</option>
                        <option value="home">üè† Maison</option>
                        <option value="kitchen">üç≥ Cuisine</option>
                        <option value="beverages">ü•§ Boissons</option>
                        <option value="food">üçï Alimentation</option>
                        <option value="vehicles">üöó V√©hicules</option>
                        <option value="travel">‚úàÔ∏è Voyages</option>
                        <option value="media">üìö M√©dias</option>
                        <option value="sports">‚öΩ Sports</option>
                        <option value="health">üíä Sant√©</option>
                        <option value="kids">üß∏ Enfants</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="product">Produit sp√©cifique</label>
                    <select id="product"></select>
                </div>
            </div>

            <!-- Settings -->
            <div class="card">
                <h2 class="cyan">‚öôÔ∏è Param√®tres</h2>
                <div class="form-group">
                    <label for="decor">D√©cor</label>
                    <select id="decor" onchange="updateDecors()">
                        <option value="indoor">Int√©rieur</option>
                        <option value="outdoor">Ext√©rieur</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="specificDecor">D√©cor sp√©cifique</label>
                    <select id="specificDecor"></select>
                </div>
                <div class="form-group">
                    <label for="lighting">√âclairage</label>
                    <select id="lighting"></select>
                </div>
                <div class="form-group">
                    <label for="angle">Angle de vue</label>
                    <select id="angle"></select>
                </div>
                <div class="form-group">
                    <label for="scenario">Sc√©nario</label>
                    <select id="scenario"></select>
                </div>
                <div class="form-group">
                    <label for="mood">Ambiance</label>
                    <select id="mood"></select>
                </div>
                <div class="form-group">
                    <label for="style">Style</label>
                    <select id="style"></select>
                </div>
            </div>

            <!-- Advanced Options -->
            <div class="card">
                <h2 class="purple">üé® Avanc√©</h2>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="includeText" onchange="generatePrompt()">
                        <label for="includeText" style="margin: 0;">Inclure du texte</label>
                    </div>
                    <input type="text" id="textContent" placeholder="Texte √† afficher..." style="display: none;" onchange="generatePrompt()">
                </div>

                <!-- Camera Settings Multi-select -->
                <div class="form-group">
                    <button class="dropdown-toggle" onclick="toggleDropdown('cameraDropdown')">
                        <span>Param√®tres cam√©ra (<span id="cameraCount">0</span>)</span>
                        <span>‚ñ∂</span>
                    </button>
                    <div id="cameraDropdown" class="dropdown-content" style="display: none;"></div>
                </div>

                <!-- Colors Multi-select -->
                <div class="form-group">
                    <button class="dropdown-toggle" onclick="toggleDropdown('colorsDropdown')">
                        <span>Couleurs (<span id="colorsCount">0</span>)</span>
                        <span>‚ñ∂</span>
                    </button>
                    <div id="colorsDropdown" class="dropdown-content" style="display: none;"></div>
                </div>

                <!-- Quality Multi-select -->
                <div class="form-group">
                    <button class="dropdown-toggle" onclick="toggleDropdown('qualityDropdown')">
                        <span>Qualit√© (<span id="qualityCount">0</span>)</span>
                        <span>‚ñ∂</span>
                    </button>
                    <div id="qualityDropdown" class="dropdown-content" style="display: none;"></div>
                </div>

                <div class="form-group">
                    <label for="additionalDetails">D√©tails additionnels</label>
                    <textarea id="additionalDetails" placeholder="Ajoutez des d√©tails suppl√©mentaires..." onchange="generatePrompt()"></textarea>
                </div>
            </div>
        </div>

        <!-- Characters Section -->
        <div class="card" style="margin-bottom: 32px;">
            <h2 class="orange">üé≠ Personnages & Interactions</h2>
            
            <div class="characters-section">
                <div class="character-count-control">
                    <label>Nombre de personnages</label>
                    <div class="character-count-buttons">
                        <button class="character-count-btn active" onclick="setCharacterCount(0)">Aucun</button>
                        <button class="character-count-btn" onclick="setCharacterCount(1)">1 personnage</button>
                        <button class="character-count-btn" onclick="setCharacterCount(2)">2 personnages</button>
                        <button class="character-count-btn" onclick="setCharacterCount(3)">3 personnages</button>
                        <button class="character-count-btn" onclick="setCharacterCount(4)">4 personnages</button>
                        <button class="character-count-btn" onclick="setCharacterCount(5)">5 personnages</button>
                    </div>
                </div>

                <div class="characters-list" id="charactersList"></div>
            </div>

            <!-- Interactions Section (visible only if 2+ characters) -->
            <div class="interactions-section" id="interactionsSection">
                <h3 style="color: #06b6d4; margin-bottom: 12px;">ü§ù Interactions entre personnages</h3>
                <div class="form-group">
                    <label for="interaction">Type d'interaction</label>
                    <select id="interaction" onchange="generatePrompt()"></select>
                </div>
                <div class="form-group">
                    <label for="positioning">Positionnement relatif</label>
                    <select id="positioning" onchange="generatePrompt()"></select>
                </div>
            </div>
        </div>

        <!-- Output Section -->
        <div class="output" id="outputSection" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 8px;">
                <h2>‚ú® Prompt G√©n√©r√©</h2>
                <div class="export-buttons">
                    <button class="btn-success" onclick="copyPrompt()">üìã Copier</button>
                    <button class="btn-secondary" onclick="exportJSON()">üì• JSON</button>
                    <button class="btn-secondary" onclick="exportTSV()">üì• TSV</button>
                    <button class="btn-secondary" onclick="exportHTML()">üì• HTML</button>
                    <button class="btn-secondary" onclick="importJSON()">üì§ Importer</button>
                    <button class="btn-danger" onclick="resetForm()">üîÑ R√©initialiser</button>
                </div>
            </div>

            <div class="prompt-box">
                <h3>‚úÖ Prompt Positif</h3>
                <div id="positivePrompt"></div>
            </div>

            <div class="prompt-box">
                <h3 class="negative">üö´ Prompt N√©gatif</h3>
                <div id="negativePrompt"></div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            üí° Version V3 : Syst√®me complet de personnages (1-5), interactions narratives, sc√®nes cin√©matographiques pour publicit√©s vid√©o
        </div>
    </div>

    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">

    <script>
        // Data
        const PRODUCTS = {
            clothing: ['t-shirt', 'chemise', 'robe', 'veste', 'manteau', 'pull', 'cardigan', 'pantalon', 'jean', 'short', 'jupe', 'legging', 'costume', 'blazer', 'hoodie', 'sweatshirt', 'gilet', 'parka', 'trench-coat', 'bomber', 'chemisier', 'd√©bardeur', 'body', 'combinaison', 'salopette', 'kimono', 'poncho', 'cape', 'v√™tement de sport', 'maillot de bain', 'lingerie'],
            shoes: ['baskets', 'chaussures de sport', 'talons hauts', 'escarpins', 'ballerines', 'mocassins', 'sandales', 'tongs', 'bottes', 'bottines', 'chaussures de randonn√©e', 'chaussures de ville', 'sneakers', 'converse', 'chaussures de course', 'chaussures de marche', 'chaussures de luxe', 'chaussures vintage', 'chaussures de soir√©e', 'chaussures casual', 'chaussures plates', 'chaussures compens√©es', 'chaussures √† lacets', 'chaussures slip-on'],
            accessories: ['sac √† main', 'sac √† dos', 'portefeuille', 'ceinture', 'chapeau', 'bonnet', '√©charpe', 'foulard', 'gants', 'mitaines', 'cravate', 'n≈ìud papillon', 'bijoux', 'bague', 'collier', 'bracelet', 'boucles d\'oreilles', 'montre', 'lunettes de soleil', 'lunettes de vue', 'casquette', 'b√©ret', 'turban', 'bandeau', '√©pingle √† cheveux', 'barrette', 'chouchou', 'serre-t√™te', 'masque', 'cache-c≈ìur'],
            beauty: ['rouge √† l√®vres', 'gloss', 'mascara', 'eyeliner', 'fard √† paupi√®res', 'fond de teint', 'poudre', 'blush', 'bronzer', 'surligneur', 'correcteur', 'crayon √† sourcils', 's√©rum', 'cr√®me hydratante', 'cr√®me anti-√¢ge', 'masque facial', 'gommage', 'nettoyant visage', 'tonique', 'lotion', 'parfum', 'eau de cologne', 'd√©odorant', 'shampooing', 'apr√®s-shampooing', 'soin des cheveux', 'gel coiffant', 'cire coiffante', 'spray coiffant', 'vernis √† ongles', 'base coat', 'top coat', 'dissolvant'],
            electronics: ['t√©l√©phone', 'smartphone', 'tablette', 'ordinateur portable', 'ordinateur de bureau', 'montre connect√©e', '√©couteurs', 'casque audio', 'enceinte', 'appareil photo', 'cam√©ra vid√©o', 'drone', 'console de jeu', 'manette de jeu', 'clavier', 'souris', '√©cran', 'batterie externe', 'c√¢ble de charge', 'adaptateur', 'chargeur', 'hub USB', 'routeur WiFi', 'modem', 'imprimante', 'scanner', 'projecteur', 'lampe LED', 'ventilateur', 'climatiseur'],
            home: ['canap√©', 'fauteuil', 'chaise', 'table', 'bureau', 'lit', 'armoire', 'commode', '√©tag√®re', 'biblioth√®que', 'lampe', 'lustre', 'applique', 'rideau', 'store', 'tapis', 'coussin', 'plaid', 'tableau', 'miroir', 'vase', 'cadre photo', 'bougie', 'diffuseur', 'horloge', 'plante', 'pot de fleur', 'couvre-lit', 'housse de canap√©', 'nappe', 'chemin de table'],
            kitchen: ['casserole', 'po√™le', 'marmite', 'cocotte', 'wok', 'planche √† d√©couper', 'couteau', 'fourchette', 'cuill√®re', 'spatule', 'louche', 'pince', 'tire-bouchon', 'ouvre-bo√Æte', 'presse-agrumes', 'mixeur', 'robot culinaire', 'four grille-pain', 'cafeti√®re', 'th√©i√®re', 'verre', 'tasse', 'assiette', 'bol', 'saladier', 'plat de service', 'plateau', 'serviette de table'],
            beverages: ['caf√©', 'th√©', 'jus de fruit', 'soda', 'eau min√©rale', 'vin', 'bi√®re', 'champagne', 'cocktail', 'smoothie', 'milkshake', 'lait', 'yaourt', 'boisson √©nerg√©tique', 'boisson sportive', 'kombucha', 'cidre', 'rhum', 'vodka', 'whisky', 'gin', 'tequila', 'liqueur', 'sirop', 'nectar'],
            food: ['pizza', 'burger', 'sandwich', 'salade', 'p√¢tes', 'riz', 'fruits', 'l√©gumes', 'viande', 'poisson', '≈ìufs', 'fromage', 'pain', 'g√¢teau', 'biscuits', 'chocolat', 'bonbons', 'glace', 'yaourt', 'c√©r√©ales', 'noix', 'graines', 'miel', 'confiture', 'beurre', 'huile', 'sauce'],
            vehicles: ['voiture de luxe', 'SUV', 'berline', 'coup√©', 'cabriolet', 'monospace', 'break', 'citadine', 'voiture de sport', 'voiture √©lectrique', 'hybride', 'moto', 'scooter', 'v√©lo', 'v√©lo √©lectrique', 'trottinette', 'skateboard', 'quad', 'buggy', 'camping-car', 'caravane', 'bateau', 'jet-ski', 'yacht'],
            travel: ['valise', 'sac de voyage', 'sac √† dos de randonn√©e', 'sac de sport', 'chaussures de randonn√©e', 'tente', 'sac de couchage', 'matelas de camping', 'appareil photo de voyage', 'jumelles', 'carte', 'boussole', 'lampe frontale', 'gourde', 'thermos', 'glaci√®re', 'hamac', 'chaise de camping', 'r√©chaud'],
            media: ['livre', 'magazine', 'journal', 'bande dessin√©e', 'manga', 'roman', 'essai', 'biographie', 'dictionnaire', 'encyclop√©die', 'atlas', 'partition musicale', 'DVD', 'Blu-ray', 'vinyle', 'cassette audio'],
            sports: ['halt√®re', 'kettlebell', 'barre de musculation', 'tapis de yoga', 'ballon de fitness', 'corde √† sauter', 'bande √©lastique', 'gants de boxe', 'raquette de tennis', 'ballon de football', 'ballon de basket', 'ballon de volley', 'planche de surf', 'skateboard', 'rollers', 'patins √† glace', 'skis', 'snowboard', 'b√¢tons de ski', 'casque de ski', 'lunettes de ski'],
            health: ['vitamines', 'suppl√©ments', 'prot√©ine en poudre', 'boisson prot√©in√©e', 'huile essentielle', 'savon', 'gel douche', 'shampoing', 'apr√®s-shampooing', 'd√©odorant', 'cr√®me', 'lotion', 'masque facial', 'brosse √† dents', 'dentifrice', 'bain de bouche', 'pansement', 'thermom√®tre', 'tensiom√®tre'],
            kids: ['jouet', 'poup√©e', 'peluche', 'voiture miniature', 'lego', 'puzzle', 'jeu de soci√©t√©', 'livre pour enfants', 'dessin anim√©', 'v√™tements enfant', 'chaussures enfant', 'couches', 'biberon', 't√©tine', 'poussette', 'si√®ge auto']
        };

        const DECORS = {
            indoor: ['studio blanc minimaliste', 'studio noir professionnel', 'loft industriel', 'appartement moderne', 'maison de luxe', 'bureau contemporain', 'boutique chic', 'caf√© artisanal', 'restaurant gastronomique', 'h√¥tel 5 √©toiles', 'galerie d\'art', 'mus√©e', 'biblioth√®que', 'salle de gym', 'spa', 'salon de beaut√©', 'cuisine professionnelle', 'salle de bain luxe', 'chambre d\'h√¥tel', 'hall d\'entr√©e', 'escalier design', 'fen√™tre panoramique', 'mur de briques', 'mur blanc', 'mur gris', 'mur de b√©ton', 'mur textur√©', 'papier peint', 'carrelage', 'parquet', 'moquette', 'sol en b√©ton poli'],
            outdoor: ['plage de sable blanc', 'plage rocheuse', 'oc√©an', 'lac', 'rivi√®re', 'montagne enneig√©e', 'for√™t dense', 'prairie fleurie', 'champ de tournesols', 'vignoble', 'jardin botanique', 'parc urbain', 'rue pav√©e', 'all√©e arbor√©e', 'pont', 'phare', 'ch√¢teau', 'ruines antiques', 'temple', 'pagode', 'd√©sert de sable', 'canyon', 'falaise', 'cascade', 'grotte', 'caverne', 'route de montagne', 'route c√¥ti√®re', 'parking', 'terrasse', 'balcon', 'toit', 'cour int√©rieure', 'jardin secret', 'verger']
        };

        const LIGHTING = ['lumi√®re naturelle douce', 'lumi√®re dor√©e du coucher de soleil', 'lumi√®re bleue de l\'aube', 'lumi√®re dure et contrast√©e', 'lumi√®re diffuse', 'lumi√®re lat√©rale', 'lumi√®re contre-jour', 'lumi√®re de studio professionnelle', 'lumi√®re LED froide', 'lumi√®re LED chaude', 'lumi√®re de chandelle', 'lumi√®re de n√©on', 'lumi√®re fluorescente', 'lumi√®re de projecteur', 'lumi√®re dramatique', 'lumi√®re cin√©matographique', 'lumi√®re √† faible cl√©', 'lumi√®re √† haut cl√©', 'lumi√®re volum√©trique', 'lumi√®re avec ombres prononc√©es', 'lumi√®re uniforme', 'lumi√®re avec reflets', 'lumi√®re avec halos', 'lumi√®re de jour nuageux', 'lumi√®re de jour ensoleill√©', 'lumi√®re d\'heure dor√©e', 'lumi√®re d\'heure bleue'];

        const ANGLES = ['vue de face', 'vue de profil', 'vue de trois quarts', 'vue de dos', 'plong√©e', 'contre-plong√©e', 'vue a√©rienne', 'vue au niveau du sol', 'macro', 'gros plan', 'plan moyen', 'plan large', 'plan d\'ensemble', 'angle 45 degr√©s', 'angle 90 degr√©s', 'angle dynamique', 'angle sym√©trique', 'angle asym√©trique', 'vue isom√©trique', 'vue en perspective', 'vue frontale', 'vue lat√©rale', 'vue diagonale', 'vue oblique', 'vue en contre-plong√©e extr√™me'];

        const CAMERA_SETTINGS = ['profondeur de champ faible, flou d\'arri√®re-plan', 'profondeur de champ profonde', 'mise au point nette sur le sujet', 'flou de mouvement', 'bokeh circulaire', 'bokeh hexagonal', 'bokeh en forme de c≈ìur', 'objectif grand angle', 'objectif t√©l√©objectif', 'objectif macro', 'objectif fisheye', 'objectif 50mm', 'objectif 85mm', 'objectif 35mm', 'objectif 24mm', 'objectif 135mm', 'vitesse d\'obturation rapide', 'vitesse d\'obturation lente', 'ISO bas', 'ISO √©lev√©', 'exposition correcte', 'surexposition l√©g√®re', 'sous-exposition l√©g√®re'];

        const SCENARIOS = ['portrait en studio', 'portrait en ext√©rieur', 'portrait lifestyle', 'portrait beaut√©', 'portrait de mode', 'portrait corporate', 'photo de produit simple', 'photo de produit en contexte', 'photo de produit lifestyle', 'photo de produit en main', 'photo de produit en d√©tail', 'photo de produit packshot', 'photo d\'ambiance', 'photo d\'atmosph√®re', 'photo narrative', 'photo conceptuelle', 'photo artistique', 'photo commerciale', 'photo √©ditoriale', 'photo de catalogue', 'photo pour r√©seaux sociaux', 'photo pour publicit√©', 'photo pour affiche', 'photo pour emballage', 'photo pour site web', 'photo d\'√©v√©nement', 'photo de groupe'];

        const MOODS = ['luxe et √©l√©gance', 'minimaliste et √©pur√©', 'dynamique et √©nergique', 'calme et serein', 'romantique et doux', 'dramatique et intense', 'joyeux et ludique', 'myst√©rieux et intrigant', 'professionnel et s√©rieux', 'cr√©atif et artistique', 'naturel et authentique', 'sophistiqu√© et raffin√©', 'urbain et moderne', 'vintage et r√©tro', 'futuriste et high-tech', 'chaleureux et accueillant', 'froid et minimaliste', 'vibrant et color√©', 'neutre et intemporel', 'tendance et contemporain', 'classique et intemporel', 'boh√®me et libre', '√©pique et grandiose', 'intime et personnel'];

        const COLORS = ['palette monochrome', 'palette pastel', 'palette satur√©e', 'palette d√©satur√©e', 'palette chaude', 'palette froide', 'palette neutre', 'palette compl√©mentaire', 'palette analogique', 'palette triadic', 'teintes de bleu', 'teintes de rouge', 'teintes de vert', 'teintes d\'or', 'teintes d\'argent', 'teintes de rose', 'teintes de violet', 'teintes d\'orange', 'teintes de marron', 'teintes de gris', 'noir et blanc', 'couleurs vibrantes', 'couleurs pastel', 'couleurs terreuses', 'couleurs oc√©an', 'couleurs for√™t', 'couleurs coucher de soleil', 'couleurs aurore'];

        const QUALITY_DESCRIPTORS = ['qualit√© photographique professionnelle', 'haute r√©solution 8K', 'r√©solution 4K', 'mise au point nette et pr√©cise', 'composition √©quilibr√©e', 'composition asym√©trique', 'composition en r√®gle des tiers', 'composition centr√©e', 'composition diagonale', 'd√©tails crisp et nets', 'texture visible', 'surface lisse', 'surface rugueuse', 'bien expos√©', 'contraste optimal', 'contraste √©lev√©', 'contraste faible', 'couleurs vibrantes', 'couleurs naturelles', 'couleurs grading cin√©matographique', 'sans artefacts', 'sans bruit', 'sans grain', 'grain cin√©matographique subtil', 'rendu r√©aliste', 'rendu hyper-r√©aliste', 'rendu l√©g√®rement stylis√©'];

        const STYLES = ['photographie commerciale', 'photographie artistique', 'photographie de mode', 'photographie de beaut√©', 'photographie de produit', 'photographie de voyage', 'photographie de rue', 'photographie de nature', 'photographie de portrait', 'photographie d\'architecture', 'photographie de nourriture', 'photographie de mariage', 'photographie d\'√©v√©nement', 'photographie de sport', 'photographie de paysage', 'photographie de faune', 'photographie de flore', 'photographie macro', 'photographie abstraite', 'photographie en noir et blanc', 'photographie couleur', 'photographie vintage', 'photographie r√©tro', 'photographie contemporaine', 'photographie minimaliste', 'photographie documentaire', 'photographie conceptuelle'];

        const CHARACTER_TYPES = ['femme √©l√©gante', 'homme charismatique', 'jeune femme dynamique', 'jeune homme sportif', 'femme mature sophistiqu√©e', 'homme mature confiant', 'enfant joyeux', 'adolescente cool', 'adolescent branch√©', 'couple heureux', 'groupe d\'amis', 'famille', 'professionnelle', 'artiste cr√©atif', 'athl√®te', 'mannequin', 'businessman', 'businesswoman'];

        const CHARACTER_AGES = ['enfant (6-12 ans)', 'adolescent (13-19 ans)', 'jeune adulte (20-30 ans)', 'adulte (30-45 ans)', 'adulte mature (45-60 ans)', 'senior (60+ ans)'];

        const CHARACTER_CLOTHING = ['casual d√©contract√©', '√©l√©gant et formel', 'sportif et dynamique', 'boh√®me et artistique', 'urbain et tendance', 'vintage et r√©tro', 'luxe et haute couture', 'minimaliste et √©pur√©', 'color√© et vibrant', 'monochrome et neutre', 'streetwear', 'business casual', 'soir√©e chic', 'plage et d√©tente', 'montagne et outdoor', 'gym et sport', 'travail professionnel', 'festival et √©v√©nement'];

        const CHARACTER_POSES = ['debout naturellement', 'assis confortablement', 'en mouvement dynamique', 'tenant le produit', 'utilisant le produit', 'regardant le produit', 'regardant la cam√©ra', 'regardant vers le bas', 'regardant vers le haut', 'souriant naturellement', 'riant joyeusement', 'pensif et s√©rieux', 'en action', 'posture d√©contract√©e', 'posture confiante', 'posture √©l√©gante', 'pench√© en avant', 'allong√©', 'accroupi', 'en √©quilibre', 'bras crois√©s', 'mains dans les poches', 'gesticulant expressif'];

        const CHARACTER_EXPRESSIONS = ['sourire naturel', 'rire joyeux', 'expression confiante', 'regard pensif', 'expression s√©rieuse', 'expression douce', 'expression intense', 'expression ludique', 'expression myst√©rieuse', 'expression surprise', 'expression admirative', 'expression contemplative', 'expression radieuse', 'expression calme', 'expression dynamique'];

        const CHARACTER_INTERACTIONS = ['conversation anim√©e', 'rire ensemble', 'interaction avec le produit', 'un personnage montre le produit √† l\'autre', 'partage et complicit√©', 'moment intime', 'collaboration', 'comp√©tition ludique', 'apprentissage', 'd√©couverte ensemble', 'moment de d√©tente', '√©change de regards', 'geste d\'amiti√©', 'c√©l√©bration', 'moment de complicit√©'];

        const CHARACTER_POSITIONING = ['c√¥te √† c√¥te', 'l\'un derri√®re l\'autre', 'face √† face', 'diagonale', 'un au premier plan, l\'autre en arri√®re-plan', 'entrelac√©s', '√©loign√©s', 'rapproch√©s', 'en triangle', 'en ligne', 'en cercle', 'asym√©trique', 'sym√©trique', 'un assis, l\'autre debout', 'tous √† la m√™me hauteur'];

        const NEGATIVE_PROMPTS = ['flou', 'mal focalis√©', 'mauvaise mise au point', 'image pixelis√©e', 'basse r√©solution', 'compression JPEG', 'artefacts', 'bruit excessif', 'grain excessif', 'surexpos√©', 'sous-expos√©', 'mauvaise exposition', 'mauvaise couleur', 'couleurs d√©lav√©es', 'couleurs satur√©es excessivement', 'composition mauvaise', 'composition confuse', '√©l√©ments mal plac√©s', 'texte mal orthographi√©', 'texte illisible', 'texte flou', 'texte d√©form√©', 'objets flottants', 'objets mal positionn√©s', 'objets coup√©s', 'mains mal dessin√©es', 'pieds mal dessin√©s', 'visage mal dessin√©', 'anatomie incorrecte', 'proportions incorrectes', 'perspective incorrecte', 'ombres incorrectes', 'ombres manquantes', '√©clairage incoh√©rent', 'reflets incorrects', 'reflets manquants', 'distorsion', 'aberration chromatique', 'watermark', 'signature', 'logo', 'filigrane', 'date', 'num√©ro de page'];

        const TEMPLATES = {
            fashion: { name: 'Mode & Luxe', product: 'robe', scenario: 'portrait de mode', characters: 1 },
            beauty: { name: 'Beaut√© & Cosm√©tiques', product: 'rouge √† l√®vres', scenario: 'portrait beaut√©', characters: 1 },
            lifestyle: { name: 'Produit Lifestyle', product: 'sac √† main', scenario: 'photo de produit lifestyle', characters: 1 },
            culinary: { name: 'üçΩÔ∏è Photographie Culinaire', product: 'pizza', scenario: 'photo de produit en contexte', characters: 2 },
            realestate: { name: 'üè† Immobilier & Architecture', product: 'canap√©', scenario: 'photo d\'ambiance', characters: 2 },
            automotive: { name: 'üöó Automobile & V√©hicules', product: 'voiture de luxe', scenario: 'photo commerciale', characters: 1 },
            electronics: { name: 'üì± √âlectronique & Tech', product: 'smartphone', scenario: 'photo de produit packshot', characters: 1 },
            travel: { name: '‚úàÔ∏è Voyages & Aventure', product: 'valise', scenario: 'photo d\'atmosph√®re', characters: 2 }
        };

        let language = 'fr';
        let history = [];
        let selectedCamera = [];
        let selectedColors = [];
        let selectedQuality = [];
        let characterCount = 0;
        let characters = [];

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            loadHistory();
            initializeSelects();
            renderTemplates();
            updateProducts();
            updateDecors();
        });

        function initializeSelects() {
            populateSelect('lighting', LIGHTING);
            populateSelect('angle', ANGLES);
            populateSelect('scenario', SCENARIOS);
            populateSelect('mood', MOODS);
            populateSelect('style', STYLES);
            populateSelect('interaction', CHARACTER_INTERACTIONS);
            populateSelect('positioning', CHARACTER_POSITIONING);
            renderMultiSelect('cameraDropdown', CAMERA_SETTINGS, 'camera');
            renderMultiSelect('colorsDropdown', COLORS, 'colors');
            renderMultiSelect('qualityDropdown', QUALITY_DESCRIPTORS, 'quality');
        }

        function populateSelect(id, items) {
            const select = document.getElementById(id);
            select.innerHTML = '<option value="">-- Optionnel --</option>';
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                select.appendChild(option);
            });
        }

        function renderMultiSelect(containerId, items, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            items.forEach(item => {
                const label = document.createElement('label');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.onchange = () => {
                    if (type === 'camera') {
                        selectedCamera = selectedCamera.includes(item) ? selectedCamera.filter(i => i !== item) : [...selectedCamera, item];
                        document.getElementById('cameraCount').textContent = selectedCamera.length;
                    } else if (type === 'colors') {
                        selectedColors = selectedColors.includes(item) ? selectedColors.filter(i => i !== item) : [...selectedColors, item];
                        document.getElementById('colorsCount').textContent = selectedColors.length;
                    } else if (type === 'quality') {
                        selectedQuality = selectedQuality.includes(item) ? selectedQuality.filter(i => i !== item) : [...selectedQuality, item];
                        document.getElementById('qualityCount').textContent = selectedQuality.length;
                    }
                    generatePrompt();
                };
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(item));
                container.appendChild(label);
            });
        }

        function updateProducts() {
            const category = document.getElementById('category').value;
            populateSelect('product', PRODUCTS[category] || []);
            generatePrompt();
        }

        function updateDecors() {
            const decor = document.getElementById('decor').value;
            populateSelect('specificDecor', DECORS[decor] || []);
            generatePrompt();
        }

        function toggleDropdown(id) {
            const dropdown = document.getElementById(id);
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        function renderTemplates() {
            const container = document.getElementById('templatesContainer');
            container.innerHTML = '';
            Object.entries(TEMPLATES).forEach(([key, template]) => {
                const card = document.createElement('div');
                card.className = 'template-card';
                card.innerHTML = `<h3>${template.name}</h3><p>${template.product} ‚Ä¢ ${template.scenario}</p>`;
                card.onclick = () => loadTemplate(key);
                container.appendChild(card);
            });
        }

        function loadTemplate(key) {
            const template = TEMPLATES[key];
            document.getElementById('product').value = template.product;
            setCharacterCount(template.characters);
            generatePrompt();
        }

        function setCharacterCount(count) {
            characterCount = count;
            characters = [];
            
            // Update button styles
            document.querySelectorAll('.character-count-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show/hide interactions section
            const interactionsSection = document.getElementById('interactionsSection');
            if (count >= 2) {
                interactionsSection.classList.add('visible');
            } else {
                interactionsSection.classList.remove('visible');
            }

            // Render character cards
            const list = document.getElementById('charactersList');
            list.innerHTML = '';

            if (count === 0) {
                list.innerHTML = '<p style="color: #94a3b8; text-align: center; padding: 20px;">Aucun personnage s√©lectionn√©</p>';
            } else {
                for (let i = 0; i < count; i++) {
                    characters.push({
                        type: '',
                        age: '',
                        clothing: '',
                        pose: '',
                        expression: '',
                        interaction: ''
                    });

                    const card = document.createElement('div');
                    card.className = 'character-card';
                    card.innerHTML = `
                        <h3>üë§ Personnage ${i + 1}</h3>
                        <div class="character-grid">
                            <div class="form-group">
                                <label>Type</label>
                                <select onchange="updateCharacter(${i}, 'type', this.value)">
                                    <option value="">-- S√©lectionner --</option>
                                    ${CHARACTER_TYPES.map(t => `<option value="${t}">${t}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>√Çge</label>
                                <select onchange="updateCharacter(${i}, 'age', this.value)">
                                    <option value="">-- Optionnel --</option>
                                    ${CHARACTER_AGES.map(a => `<option value="${a}">${a}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>V√™tements</label>
                                <select onchange="updateCharacter(${i}, 'clothing', this.value)">
                                    <option value="">-- Optionnel --</option>
                                    ${CHARACTER_CLOTHING.map(c => `<option value="${c}">${c}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Pose</label>
                                <select onchange="updateCharacter(${i}, 'pose', this.value)">
                                    <option value="">-- Optionnel --</option>
                                    ${CHARACTER_POSES.map(p => `<option value="${p}">${p}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Expression</label>
                                <select onchange="updateCharacter(${i}, 'expression', this.value)">
                                    <option value="">-- Optionnel --</option>
                                    ${CHARACTER_EXPRESSIONS.map(e => `<option value="${e}">${e}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Interaction avec produit</label>
                                <select onchange="updateCharacter(${i}, 'interaction', this.value)">
                                    <option value="">-- Optionnel --</option>
                                    <option value="tenant le produit">tenant le produit</option>
                                    <option value="utilisant le produit">utilisant le produit</option>
                                    <option value="regardant le produit">regardant le produit</option>
                                    <option value="montrant le produit">montrant le produit</option>
                                    <option value="touchant le produit">touchant le produit</option>
                                    <option value="pr√©sentant le produit">pr√©sentant le produit</option>
                                    <option value="admirant le produit">admirant le produit</option>
                                    <option value="sans interaction">sans interaction</option>
                                </select>
                            </div>
                        </div>
                    `;
                    list.appendChild(card);
                }
            }

            generatePrompt();
        }

        function updateCharacter(index, field, value) {
            if (characters[index]) {
                characters[index][field] = value;
                generatePrompt();
            }
        }

        function generatePrompt() {
            const product = document.getElementById('product').value;
            if (!product) {
                document.getElementById('outputSection').style.display = 'none';
                return;
            }

            const decor = document.getElementById('decor').value;
            const specificDecor = document.getElementById('specificDecor').value;
            const lighting = document.getElementById('lighting').value;
            const angle = document.getElementById('angle').value;
            const scenario = document.getElementById('scenario').value;
            const mood = document.getElementById('mood').value;
            const style = document.getElementById('style').value;
            const additionalDetails = document.getElementById('additionalDetails').value;
            const includeText = document.getElementById('includeText').checked;
            const textContent = document.getElementById('textContent').value;
            const interaction = document.getElementById('interaction').value;
            const positioning = document.getElementById('positioning').value;

            let prompt = `Photo publicitaire professionnelle d'un ${product}`;
            
            // Add characters description
            if (characterCount > 0) {
                const characterDescriptions = characters
                    .filter(c => c.type)
                    .map(c => {
                        let desc = c.type;
                        if (c.age) desc += ` (${c.age})`;
                        if (c.clothing) desc += `, ${c.clothing}`;
                        if (c.pose) desc += `, ${c.pose}`;
                        if (c.expression) desc += `, ${c.expression}`;
                        if (c.interaction) desc += `, ${c.interaction}`;
                        return desc;
                    });

                if (characterDescriptions.length > 0) {
                    prompt += `, avec ${characterCount === 1 ? 'un personnage: ' : `${characterCount} personnages: `}${characterDescriptions.join(' | ')}`;
                }

                // Add interactions
                if (characterCount >= 2 && interaction) {
                    prompt += `, ${interaction}`;
                }
                if (characterCount >= 2 && positioning) {
                    prompt += `, positionnement: ${positioning}`;
                }
            }

            if (specificDecor || decor) {
                prompt += `, en ${specificDecor || decor === 'indoor' ? 'int√©rieur' : 'ext√©rieur'}`;
            }

            if (scenario) prompt += `, ${scenario}`;
            if (lighting) prompt += `, ${lighting}`;
            if (angle) prompt += `, ${angle}`;
            if (selectedCamera.length > 0) prompt += `, ${selectedCamera.join(', ')}`;
            if (mood) prompt += `, ambiance ${mood}`;
            if (selectedColors.length > 0) prompt += `, ${selectedColors.join(', ')}`;
            if (style) prompt += `, style ${style}`;
            if (selectedQuality.length > 0) prompt += `, ${selectedQuality.join(', ')}`;
            if (includeText && textContent) prompt += `, avec le texte "${textContent}" visible et lisible`;
            if (additionalDetails) prompt += `, ${additionalDetails}`;

            prompt += `. Qualit√© professionnelle, sans d√©fauts, sans artefacts, sans watermark.`;

            const negativePrompt = `√âviter: ${NEGATIVE_PROMPTS.join(', ')}.`;

            document.getElementById('positivePrompt').textContent = prompt;
            document.getElementById('negativePrompt').textContent = negativePrompt;
            document.getElementById('outputSection').style.display = 'block';

            // Update text visibility
            document.getElementById('textContent').style.display = includeText ? 'block' : 'none';
        }

        function copyPrompt() {
            const prompt = document.getElementById('positivePrompt').textContent;
            navigator.clipboard.writeText(prompt).then(() => {
                alert('Prompt copi√© !');
                saveToHistory(document.getElementById('product').value, prompt, document.getElementById('negativePrompt').textContent);
            });
        }

        function saveToHistory(product, prompt, negativePrompt) {
            const item = {
                id: Date.now(),
                timestamp: new Date().toLocaleString('fr-FR'),
                product,
                prompt,
                negativePrompt
            };
            history.unshift(item);
            history = history.slice(0, 10);
            localStorage.setItem('promptHistory', JSON.stringify(history));
            document.getElementById('historyCount').textContent = history.length;
            renderHistory();
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            history.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <div class="history-item-info">
                        <div class="history-item-product">${item.product}</div>
                        <div class="history-item-date">${item.timestamp}</div>
                    </div>
                    <div class="history-item-buttons">
                        <button class="btn-success btn-small" onclick="navigator.clipboard.writeText('${item.prompt.replace(/'/g, "\\'")}')">Copier</button>
                        <button class="btn-danger btn-small" onclick="deleteHistory(${item.id})">Supprimer</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function deleteHistory(id) {
            history = history.filter(item => item.id !== id);
            localStorage.setItem('promptHistory', JSON.stringify(history));
            document.getElementById('historyCount').textContent = history.length;
            renderHistory();
        }

        function loadHistory() {
            const saved = localStorage.getItem('promptHistory');
            if (saved) {
                try {
                    history = JSON.parse(saved);
                    document.getElementById('historyCount').textContent = history.length;
                    renderHistory();
                } catch (e) {
                    console.error('Erreur lors du chargement de l\'historique', e);
                }
            }
        }

        function toggleHistory() {
            const section = document.getElementById('historySection');
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
        }

        function exportJSON() {
            const data = {
                product: document.getElementById('product').value,
                decor: document.getElementById('decor').value,
                specificDecor: document.getElementById('specificDecor').value,
                lighting: document.getElementById('lighting').value,
                angle: document.getElementById('angle').value,
                scenario: document.getElementById('scenario').value,
                mood: document.getElementById('mood').value,
                style: document.getElementById('style').value,
                cameraSettings: selectedCamera,
                colors: selectedColors,
                quality: selectedQuality,
                additionalDetails: document.getElementById('additionalDetails').value,
                includeText: document.getElementById('includeText').checked,
                textContent: document.getElementById('textContent').value,
                characterCount: characterCount,
                characters: characters,
                interaction: document.getElementById('interaction').value,
                positioning: document.getElementById('positioning').value
            };
            const dataStr = JSON.stringify(data, null, 2);
            const element = document.createElement('a');
            element.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr));
            element.setAttribute('download', `prompt_config_${new Date().toISOString().split('T')[0]}.json`);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        function exportTSV() {
            let tsv = `Nom du champ\tValeur\nProduit\t${document.getElementById('product').value}\nD√©cor\t${document.getElementById('specificDecor').value || document.getElementById('decor').value}\n√âclairage\t${document.getElementById('lighting').value}\nAngle\t${document.getElementById('angle').value}\nSc√©nario\t${document.getElementById('scenario').value}\nAmbiance\t${document.getElementById('mood').value}\nCouleurs\t${selectedColors.join('; ')}\nStyle\t${document.getElementById('style').value}\nQualit√©\t${selectedQuality.join('; ')}\nD√©tails additionnels\t${document.getElementById('additionalDetails').value}\nTexte\t${document.getElementById('includeText').checked ? document.getElementById('textContent').value : 'Non'}\nNombre de personnages\t${characterCount}\n`;
            
            characters.forEach((c, i) => {
                tsv += `\nPersonnage ${i + 1}\t\nType\t${c.type}\n√Çge\t${c.age}\nV√™tements\t${c.clothing}\nPose\t${c.pose}\nExpression\t${c.expression}\nInteraction\t${c.interaction}\n`;
            });

            tsv += `\nPROMPT POSITIF\t\n${document.getElementById('positivePrompt').textContent}\n\nPROMPT N√âGATIF\t\n${document.getElementById('negativePrompt').textContent}`;
            
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/tab-separated-values;charset=utf-8,' + encodeURIComponent(tsv));
            element.setAttribute('download', `prompt_${new Date().toISOString().split('T')[0]}.tsv`);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        function exportHTML() {
            const html = `<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prompt Publicitaire</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
    .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #333; border-bottom: 3px solid #ff6b9d; padding-bottom: 10px; }
    h2 { color: #666; margin-top: 25px; }
    .config { background: #f9f9f9; padding: 15px; border-radius: 5px; margin: 15px 0; }
    .config-item { display: grid; grid-template-columns: 150px 1fr; gap: 15px; margin: 8px 0; }
    .label { font-weight: bold; color: #555; }
    .prompt-box { background: #1a1a1a; color: #e8e8e8; padding: 20px; border-radius: 5px; margin: 15px 0; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; }
    .positive { border-left: 4px solid #4caf50; }
    .negative { border-left: 4px solid #f44336; }
    .generated-date { color: #999; font-size: 0.9em; margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd; }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ú® Prompt Publicitaire G√©n√©r√©</h1>
    <div class="config">
      <div class="config-item"><div class="label">Produit:</div><div>${document.getElementById('product').value}</div></div>
      <div class="config-item"><div class="label">D√©cor:</div><div>${document.getElementById('specificDecor').value || document.getElementById('decor').value}</div></div>
      <div class="config-item"><div class="label">√âclairage:</div><div>${document.getElementById('lighting').value || '-'}</div></div>
      <div class="config-item"><div class="label">Angle:</div><div>${document.getElementById('angle').value || '-'}</div></div>
      <div class="config-item"><div class="label">Sc√©nario:</div><div>${document.getElementById('scenario').value || '-'}</div></div>
      <div class="config-item"><div class="label">Ambiance:</div><div>${document.getElementById('mood').value || '-'}</div></div>
      <div class="config-item"><div class="label">Couleurs:</div><div>${selectedColors.join(', ') || '-'}</div></div>
      <div class="config-item"><div class="label">Style:</div><div>${document.getElementById('style').value || '-'}</div></div>
      <div class="config-item"><div class="label">Qualit√©:</div><div>${selectedQuality.join(', ') || '-'}</div></div>
      <div class="config-item"><div class="label">Personnages:</div><div>${characterCount || 'Aucun'}</div></div>
    </div>
    <h2>Prompts G√©n√©r√©s</h2>
    <div class="prompt-box positive">
      <strong>‚úÖ PROMPT POSITIF</strong>
      ${document.getElementById('positivePrompt').textContent}
    </div>
    <div class="prompt-box negative">
      <strong>üö´ PROMPT N√âGATIF</strong>
      ${document.getElementById('negativePrompt').textContent}
    </div>
    <div class="generated-date">G√©n√©r√© le: ${new Date().toLocaleString('fr-FR')}</div>
  </div>
</body>
</html>`;
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/html;charset=utf-8,' + encodeURIComponent(html));
            element.setAttribute('download', `prompt_${new Date().toISOString().split('T')[0]}.html`);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        function importJSON() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    document.getElementById('product').value = data.product || '';
                    document.getElementById('decor').value = data.decor || 'indoor';
                    document.getElementById('specificDecor').value = data.specificDecor || '';
                    document.getElementById('lighting').value = data.lighting || '';
                    document.getElementById('angle').value = data.angle || '';
                    document.getElementById('scenario').value = data.scenario || '';
                    document.getElementById('mood').value = data.mood || '';
                    document.getElementById('style').value = data.style || '';
                    document.getElementById('additionalDetails').value = data.additionalDetails || '';
                    document.getElementById('includeText').checked = data.includeText || false;
                    document.getElementById('textContent').value = data.textContent || '';
                    document.getElementById('interaction').value = data.interaction || '';
                    document.getElementById('positioning').value = data.positioning || '';
                    selectedCamera = data.cameraSettings || [];
                    selectedColors = data.colors || [];
                    selectedQuality = data.quality || [];
                    document.getElementById('cameraCount').textContent = selectedCamera.length;
                    document.getElementById('colorsCount').textContent = selectedColors.length;
                    document.getElementById('qualityCount').textContent = selectedQuality.length;
                    
                    // Restore characters
                    if (data.characterCount) {
                        setCharacterCount(data.characterCount);
                        characters = data.characters || [];
                    }
                    
                    generatePrompt();
                    alert('Configuration import√©e avec succ√®s !');
                } catch (error) {
                    alert('Erreur lors de l\'import du fichier JSON');
                }
            };
            reader.readAsText(file);
        }

        function resetForm() {
            document.getElementById('product').value = '';
            document.getElementById('decor').value = 'indoor';
            document.getElementById('specificDecor').value = '';
            document.getElementById('lighting').value = '';
            document.getElementById('angle').value = '';
            document.getElementById('scenario').value = '';
            document.getElementById('mood').value = '';
            document.getElementById('style').value = '';
            document.getElementById('additionalDetails').value = '';
            document.getElementById('includeText').checked = false;
            document.getElementById('textContent').value = '';
            document.getElementById('interaction').value = '';
            document.getElementById('positioning').value = '';
            selectedCamera = [];
            selectedColors = [];
            selectedQuality = [];
            document.getElementById('cameraCount').textContent = '0';
            document.getElementById('colorsCount').textContent = '0';
            document.getElementById('qualityCount').textContent = '0';
            setCharacterCount(0);
            document.getElementById('outputSection').style.display = 'none';
        }

        function changeLanguage(lang) {
            language = lang;
            // Note: Full translation would require more extensive changes
        }
    </script>
</body>
</html>
