<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Prompt Dieselpunk</title>
    <style>
        :root {
            --bg-color: #1a1a1d;
            --panel-color: #2c2c30;
            --text-color: #c5c6c7;
            --accent-color: #e8902b; /* Orange rouille */
            --accent-hover: #ffaa4d;
            --border-color: #4e4e50;
            --input-bg: #0f0f10;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: var(--accent-color);
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 2px 2px 0px #000;
            margin-bottom: 10px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
            width: 100%;
            text-align: center;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            width: 100%;
            max-width: 1400px;
            margin-bottom: 20px;
        }

        .menu-block {
            background-color: var(--panel-color);
            border: 1px solid var(--border-color);
            padding: 10px;
            border-radius: 4px;
            box-shadow: 3px 3px 0px rgba(0,0,0,0.5);
            position: relative;
        }

        .menu-label {
            display: block;
            font-size: 0.85em;
            color: var(--accent-color);
            margin-bottom: 5px;
            font-weight: bold;
        }

        select, input[type="text"], input[type="number"] {
            width: 100%;
            background-color: var(--input-bg);
            color: #fff;
            border: 1px solid var(--border-color);
            padding: 8px;
            font-family: inherit;
            font-size: 0.9em;
            box-sizing: border-box;
            border-radius: 2px;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .custom-input {
            display: none; /* Cach√© par d√©faut */
            margin-top: 5px;
            border-left: 3px solid var(--accent-color);
            padding-left: 5px;
        }

        /* Zone de contr√¥le */
        .controls {
            width: 100%;
            max-width: 1400px;
            background-color: var(--panel-color);
            border: 1px solid var(--border-color);
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.5);
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        button {
            background-color: #000;
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
            padding: 10px 20px;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s;
        }

        button:hover {
            background-color: var(--accent-color);
            color: #000;
            box-shadow: 0 0 10px var(--accent-color);
        }

        button.secondary {
            border-color: var(--text-color);
            color: var(--text-color);
        }
        
        button.secondary:hover {
            background-color: var(--text-color);
            color: #000;
            box-shadow: 0 0 10px var(--text-color);
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            cursor: pointer;
        }

        /* Zone de r√©sultat */
        .output-area {
            width: 100%;
            max-width: 1400px;
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            height: 150px;
            background-color: #000;
            color: #0f0; /* Vert terminal */
            border: 1px solid var(--border-color);
            padding: 10px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            box-sizing: border-box;
        }

        .negative-preview {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }

        /* Toast notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            border-bottom: 3px solid var(--accent-color);
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from {bottom: 0; opacity: 0;}
            to {bottom: 30px; opacity: 1;}
        }
        @keyframes fadeout {
            from {bottom: 30px; opacity: 1;}
            to {bottom: 0; opacity: 0;}
        }
   .top-right {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
    z-index: 1000;
}

body {
    padding-top: 80px;
}
.btn-retour {
    display: inline-block;
    padding: 12px 20px;
    background: #007BFF;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
}
    </style>
</head>
<body>
<div class="top-right">
    <a href="index.html" class="btn-retour">üè† Accueil</a>
    <a href="repertoire/index.html" class="btn-retour">üìö R√©pertoire</a>
</div>
    
    <h1>G√©n√©rateur Dieselpunk V1.0</h1>

    <div class="container" id="menus-container">
        <!-- Les menus seront g√©n√©r√©s ici par JavaScript -->
    </div>
<div class="controls" style="border-color: #e8902b; flex-direction: column; align-items: stretch;">
    <label class="menu-label">1. TON TOKEN HUGGING FACE</label>
    <input type="password" id="hf-token-input" placeholder="Colle ton token hf_... ici" style="width: 100%; background: #111; color: var(--accent-hover); border: 1px solid var(--border-color); padding: 8px; margin-bottom: 15px; font-family: monospace;">

    <label class="menu-label">2. ANALYSE D'IMAGE</label>
    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
        <input type="file" id="image-input" accept="image/*" style="font-size: 0.8em;">
        <button id="btn-interrogate" onclick="runInterrogation()">Analyser</button>
    </div>

    <label class="menu-label">R√âSULTAT DE L'ANALYSE</label>
    <textarea id="ai-base-content" placeholder="La description appara√Ætra ici..." style="height: 50px; background: #000; color: #fff; border: 1px solid var(--border-color);"></textarea>
    
    <div id="status-area" style="font-size: 0.7em; color: var(--accent-color); text-align: center; margin-top: 5px; font-style: italic;">
        Pr√™t (utilise l'API distante)
    </div>
</div>
</div>
    <div class="controls">
        <button onclick="generatePrompt()">G√©n√©rer le prompt</button>
        <button onclick="surprisePrompt()" class="secondary">Prompt Surprise</button>
        <button onclick="copyToClipboard()" class="secondary">Copier le prompt</button>
        <button onclick="resetAll()" class="secondary">Reset √† 100%</button>
        <button onclick="exportTxt()" class="secondary">Exporter .txt</button>

        <div class="control-group">
    <div class="toggle-container" title="Pond√©rer le sujet et le style">
        <input type="checkbox" id="weight-toggle">
        <label for="weight-toggle">Boost Pond√©ration (1.2x)</label>
    </div>
    
    <div style="display: flex; align-items: center; gap: 5px;">
        <input type="number" id="seed-input" placeholder="Seed Auto" style="width: 120px;">
        <button type="button" onclick="randomizeSeed()" style="padding: 8px 12px;" title="G√©n√©rer un nouveau Seed al√©atoire">üé≤</button>
    </div>
</div>

    <div class="output-area">
        <label class="menu-label">R√©sultat Prompt Positif :</label>
        <textarea id="output-positive" readonly placeholder="Le prompt appara√Ætra ici..."></textarea>
        
        <label class="menu-label" style="margin-top:10px; display:block;">Aper√ßu Prompt N√©gatif (Auto-g√©r√©) :</label>
        <div id="output-negative-preview" class="negative-preview">text, watermark, signature, ...</div>
    </div>

    <div id="toast">Prompt copi√© dans le presse-papier !</div>

    <script>
        // --- DONN√âES DES MENUS ---
        const menusData = [
            {
                title: "PERSONNAGE / SUJET",
                id: "menu_sujet",
                options: [
                    "Ing√©nieur cybern√©tique (cheveux argent√©s, combinaison kevlar)",
                    "M√©canicien borgne (moustache fournie, salopette tach√©e)",
                    "Pilote d'a√©ronef (casque cuir, √©charpe au vent)",
                    "Cartographe nomade (manteau toile cir√©e, yeux per√ßants)",
                    "Alchimiste juv√©nile (teint verd√¢tre, tunique runique)",
                    "Chanteuse de cabaret (robe fourreau scintillante, boa de plumes)",
                    "Aviateur (combinaison z√©br√©e, casque profil√©)",
                    "D√©tective priv√© (trench-coat froiss√©, fedora)",
                    "H√¥tesse de l'air (combinaison moulante √† hublots, years 50)",
                    "Ouvrier d'usine (combinaison us√©e, masque √† gaz)",
                    "Mar√©chal sovi√©tique cyborg (uniforme rouge et or, buste m√©canique)",
                    "M√©cha nazi colossal (gris militariste, croix gamm√©es, yeux rouges)",
                    "Samoura√Ø dieselpunk (armure lamell√©e noire, tech int√©gr√©e)",
                    "Seigneur de guerre squelette (cr√¢ne cybern√©tique, armure rivet√©e)",
                    "Herboriste (corset ajour√© de vitraux, gants longs)",
                    "Soldat d'√©lite (armure complexe, masque √† gaz)",
                    "Gentilhomme gangster (costume √©l√©gant, pistolet-mitrailleur)",
                    "Aventurier pulp (veste en cuir, fouet ou sac √† dos)",
                    "Gardien de phare (v√™tements huileux, silhouette solitaire)",
                    "Robot d'entretien (t√¥les embouties, articulations apparentes)"
                ]
            },
            {
                title: "ACTION / POSTURE",
                id: "menu_action",
                options: [
                    "R√©pare un g√©n√©rateur antigravit√© massive",
                    "Assemble une proth√®se m√©canique g√©ante",
                    "Inspecte les moteurs d'un dirigeable",
                    "Trace des itin√©raires sur une table holographique rudimentaire",
                    "M√©lange des √©lixirs dangereux",
                    "Escalade une √©chelle de maintenance verticale",
                    "Chante sur une sc√®ne illumin√©e",
                    "Pilote un hydravion √† grande vitesse",
                    "D√©gaine son revolver dans un hangar",
                    "Active une machine infernale",
                    "Cueille des plantes luminescentes",
                    "Marche vers une horde de zombies",
                    "Charge au milieu de la fum√©e et des flammes",
                    "Observe l'horizon depuis une tour de guet",
                    "Salue militairement sous une pluie battante",
                    "Tombe du ciel en parachute d√©chir√©",
                    "Survit dans un paysage de d√©combres",
                    "N√©gocie avec un officier ennemi",
                    "Croise le fer sous la pluie",
                    "Se tient immobile, silhouette mena√ßante"
                ]
            },
            {
                title: "LIEU / ENVIRONNEMENT",
                id: "menu_lieu",
                options: [
                    "C≈ìur d'une raffinerie flottante sur oc√©an de nuages orang√©s",
                    "Atelier souterrain encombr√© de pistons et engrenages",
                    "Plateforme a√©rienne entre deux gratte-ciel de briques",
                    "Tour de guet rouill√©e dominant une vall√©e de derricks en feu",
                    "Laboratoire perch√© sur une cataracte de p√©trole",
                    "Cath√©drale-usine illumin√©e par des fours internes",
                    "Sc√®ne de paquebot volant art d√©co",
                    "Canyon de gratte-ciel style streamline (ann√©es 30)",
                    "Hangar clandestin rempli de caisses d'armes",
                    "Station orbitale aux parois incurv√©es et n√©ons verts",
                    "Usine souterraine aux engrenages g√©ants tordus",
                    "Serre suspendue √† une tour de fer forg√©",
                    "Ch√¢teau japonais f√©odal reconverti en forteresse diesel",
                    "Cit√© hybride (victorien, byzantin, n√©o-futuriste)",
                    "D√©sert post-apocalyptique aux routes poussi√©reuses",
                    "M√©tropole industrielle nocturne style Gotham",
                    "Pont m√©tallique au-dessus d'un fleuve pollu√©",
                    "Trenches boueuses √©clair√©es par des lanternes",
                    "Citadelle chinoise imp√©riale sur falaise rocheuse",
                    "Ruines urbaines envahies par la v√©g√©tation"
                ]
            },
            {
                title: "√âPOQUE / P√âRIODE",
                id: "menu_epoque",
                options: [
                    "Ann√©es Folles (Roaring Twenties - 1920s)",
                    "Grande D√©pression (1930s)",
                    "Seconde Guerre Mondiale (1940s historique)",
                    "Guerre Mondiale Alternative (Mechs vs Nazis)",
                    "Imm√©diat Apr√®s-guerre (Fin des ann√©es 40)",
                    "√Çge Atomique (Ann√©es 50 - Atompunk)",
                    "Futur R√©tro 1920 (Ce qui aurait d√ª √™tre)",
                    "Ann√©es 30 Pulp (Aventure et Serials)",
                    "Transition Diesel-√âlectrique",
                    "Guerre Civile Alternate History",
                    "√Çge d'Or de l'Aviation",
                    "√àre industrielle victorienne tardive"
                ]
            },
            {
                title: "CADRAGE / COMPOSITION",
                id: "menu_cadrage",
                options: [
                    "Gros plan intense sur le visage",
                    "Plan moyen (bustier)",
                    "Plan am√©ricain (taille-cuisses)",
                    "Plan large d'ambiance",
                    "Vue en plong√©e (vu du dessus)",
                    "Vue contre-plong√©e (vue du bas, h√©ro√Øque)",
                    "Vue a√©rienne (Bird's eye view)",
                    "Perspective √† la premi√®re personne (POV)",
                    "Profil lat√©ral pur",
                    "Cadrage serr√© (Close-up d√©tail)",
                    "Plan d'ensemble grandiose",
                    "Vue subjective √† travers un viseur"
                ]
            },
            {
                title: "PALETTE DE COULEURS",
                id: "menu_couleur",
                options: [
                    "Teal & Orange cin√©matographique",
                    "Noir & Blanc contrast√© (Film Noir)",
                    "S√©pia vintage et chaud",
                    "Terre, Ocre et Rouille (Industrial)",
                    "Chrome, Bleu acier et Froid",
                    "Or, Noir et Ivoire (Art D√©co)",
                    "Pastel et Menthe (Atompunk 50s)",
                    "Rouge et Noir (Totalitarisme/Sang)",
                    "Vert toxique, Gris et Poussi√®re",
                    "Satur√© Pulp Magazine (Vives)",
                    "D√©satur√© Post-Apocalyptique (Terne)",
                    "Bleu nuit et Or (Glamour nuit)"
                ]
            },
            {
                title: "EXPRESSION DU VISAGE",
                id: "menu_expression",
                options: [
                    "D√©termin√© et sto√Øque",
                    "Myst√©rieux et inscrutable",
                    "Effray√© et paniqu√©",
                    "En col√®re et criant",
                    "√âmerveill√© (yeux √©carquill√©s)",
                    "M√©prisant et hautain",
                    "Las et fatigu√© (v√©t√©ran)",
                    "Maniaque et fou",
                    "S√©rieux et concentr√©",
                    "Fou rire sadique",
                    "Triste et m√©lancolique",
                    "Soup√ßonneux (regard de c√¥t√©)",
                    "Calme et serein",
                    "Douloureux (bless√©)",
                    "Apathique (r√©sign√©)"
                ]
            },
            {
                title: "COMPAGNON",
                id: "menu_compagnon",
                options: [
                    "Robot assisteur bip√®de rouill√©",
                    "Chien m√©canique √† vapeur",
                    "Homme de main silencieux et massif",
                    "Assistante f√©line en tenue cuir",
                    "Cr√©ature modifi√©e g√©n√©tiquement",
                    "Esclave cybern√©tique docile",
                    "Duo d'√©lite militaire (m√©dic)",
                    "Hologramme fantomatique",
                    "Oiseau pr√©dateur robotique",
                    "Petite orpheline voleuse",
                    "Singe cyborg ing√©nieur",
                    "Vampire aristocratique",
                    "Zombie industriel lent",
                    "Agent double en civil",
                    "G√©nie excentrique"
                ]
            },
            {
                title: "OBJET",
                id: "menu_objet",
                options: [
                    "Lance-flammes lourd et massif",
                    "Jetpack en cuir usag√©",
                    "Tablette holographique rudimentaire",
                    "Boussole antique complexe",
                    "Masque √† gaz vintage (filter box)",
                    "Radio √† lampes et potentiom√®tres",
                    "Arme √† √©nergie exp√©rimentale",
                    "Clef anglaise g√©ante",
                    "Livre de sorts m√©canique (automate)",
                    "Drapeau national d√©chir√©",
                    "Bouteille d'√©ther luminescent",
                    "Cartes g√©ographiques jaunies",
                    "Proth√®se m√©canique d√©taill√©e",
                    "Valise atomique (bombe)",
                    "M√©daillon patriotique"
                ]
            },
            {
                title: "STYLE GRAPHIQUE / ESTH√âTIQUE",
                id: "menu_style",
                options: [
                    "Peinture num√©rique r√©aliste (hyper-d√©taill√©)",
                    "Ligne claire / inking comics (contours nets)",
                    "Dieselpunk industriel monumental",
                    "Art D√©co / Decopunk (g√©om√©trique, luxe)",
                    "Streamline Moderne (a√©rodynamique)",
                    "Pulp illustration (couleurs vives, dramatique)",
                    "Atompunk / Raygun Gothic (50s optimiste)",
                    "Expressionnisme allemand / Metropolis (sombre)",
                    "Art Nouveau r√©trofuturiste (organique)",
                    "Anime r√©aliste style Yoji Shinkawa",
                    "Dark Fantasy / Warhammer 40k",
                    "Noir et blanc gravure r√©aliste",
                    "Illustration publicitaire vintage",
                    "Photographie vintage coloris√©e",
                    "Peinture impressionniste moderne",
                    "Concept art industriel complexe"
                ]
            },
            {
                title: "EFFETS SP√âCIAUX (VFX)",
                id: "menu_vfx",
                options: [
                    "Explosion de vapeur et fum√©e",
                    "Pluie battante et r√©verb√©rations",
                    "Fum√©e noire √©paisse (carbone)",
                    "√âtincelles √©lectriques (court-circuit)",
                    "Flammes d'enfer et incendies",
                    "Lens flare (halo lumineux)",
                    "Tra√Æn√©es de condensation (vapeur avion)",
                    "Boue et √©claboussures",
                    "Particules de poussi√®re dans la lumi√®re",
                    "Reflets m√©talliques intenses (specular)",
                    "Brume √©paisse et atmosph√©rique",
                    "D√©bris volants (gravats)",
                    "Onde de choc",
                    "√âclipse solaire",
                    "Pluie de cendres"
                ]
            },
            {
                title: "TEXTURES DE RENDU",
                id: "menu_textures",
                options: [
                    "M√©tal rouill√© et corrod√©",
                    "Peau humide et sueur",
                    "Cuir vieilli et craquel√©",
                    "Acier bross√© industriel",
                    "Laiton patin√© (tarnished brass)",
                    "Verre sale et poussi√©reux",
                    "Tissu √©pais et lourd",
                    "Carton bouilli (cuirasse)",
                    "Bois carbonis√©",
                    "Porcelaine √©caill√©e",
                    "Chrome poli (miroir)",
                    "Huile et graisse",
                    "B√©ton arm√© brut",
                    "Caoutchouc noir",
                    "Poussi√®re de charbon"
                ]
            },
            {
                title: "GRAIN / TEXTURE FILM",
                id: "menu_grain",
                options: [
                    "Grain argentique fin",
                    "Grain fort (ann√©es 40 documentaire)",
                    "Rayures et poussi√®res de projection",
                    "Vignettage s√©v√®re (coins noirs)",
                    "Photo jaunie par le temps",
                    "Pellicule endommag√©e (d√©chirures)",
                    "Noir et blanc film vintage",
                    "Flou de boug√© (motion blur)",
                    "Crois√© de teintes (cross-process)",
                    "Effet flashback nostalgique"
                ]
            },
            {
                title: "COMPOSITION AVANC√âE",
                id: "menu_compo_adv",
                options: [
                    "R√®gle des tiers dynamique",
                    "Sym√©trie parfaite (centr√©e)",
                    "Perspective verticale extr√™me (key visual)",
                    "Perspective diagonale forte",
                    "Cadre dans le cadre (porte/fen√™tre)",
                    "Lignes directrices (rails, routes)",
                    "Espace n√©gatif dominant (isolement)",
                    "Remplissage du cadre (claustrophobie)",
                    "Spirale dor√©e",
                    "Mise en abyme",
                    "D√©s√©quilibre contr√¥l√© (tension)"
                ]
            },
            {
                title: "PROFONDEUR DE CHAMP (DOF)",
                id: "menu_dof",
                options: [
                    "Faible profondeur de champ (flou arri√®re)",
                    "Grande profondeur de champ (tout net)",
                    "Focus s√©lectif sur les yeux",
                    "Focus sur l'objet premier plan",
                    "Bokeh doux et cr√©meux",
                    "Miniature (Tilt-shift)",
                    "Focus infini (paysage lointain)",
                    "Double exposition (flou artistique)"
                ]
            },
            {
                title: "TROPES VISUELS DIESERPUNK",
                id: "menu_tropes",
                options: [
                    "Tuyaux et conduits apparents partout",
                    "Rivets industriels massifs",
                    "H√©lices d'avion et turbines",
                    "Formes a√©rodynamiques (Streamline)",
                    "Motifs g√©om√©triques Art D√©co (Zigzags)",
                    "Architecture verticale oppressante",
                    "Graffiti de propagande politique",
                    "N√©ons et enseignes au n√©on",
                    "V√™tements fonctionnels avec nombreuses poches",
                    "Implantations cybern√©tiques expos√©es",
                    "Vapeur s'√©chappant des soupapes",
                    "Lignes de fuite perspective forc√©e",
                    "Silhouettes contre l'√©clairage (backlight)",
                    "Miroirs et surfaces r√©fl√©chissantes",
                    "Technologie 'Bricol√©e' (Kitbash)"
                ]
            },
            {
                title: "R√âF√âRENCE ARTISTIQUE",
                id: "menu_artiste",
                options: [
                    "Style de Alejandro Burdisio (voitures volantes)",
                    "Style de Sam Van Olffen (soci√©t√©s dystopiques)",
                    "Style de Keith Thompson (inventions WWII)",
                    "Style de Stefan Prohaczka (portraits diesel)",
                    "Style de Mike Mignola (Hellboy, lignes sombres)",
                    "Style de Tom Floyd (comics pulp)",
                    "Style de Tim Huhn (s√©rie Art Deco)",
                    "Style de Max Bedulenko (villes kitbash)",
                    "Style de Frank Frazetta (pulp heroic)",
                    "Style de Simon St√•lenhag (onirique m√©lancolique)",
                    "Style de Makoto Shinkai (d√©cors d√©taill√©s)",
                    "Style de Yoji Shinkawa (croquis dynamique)",
                    "Style de Gil Elvgren (pin-up modernis√©)",
                    "Style de Norman Bel Geddes (Streamline)",
                    "Style de Hugh Ferriss (architecture massive)",
                    "Style de Dean Cornwell (illustrations pulp)",
                    "Style de J.H. Williams III (ligne claire)"
                ]
            },
            {
                title: "BOOSTS QUALIT√â",
                id: "menu_quality",
                options: [
                    "Ultra-d√©taill√© (Highly detailed)",
                    "8k, 4k",
                    "Masterpiece",
                    "Meilleur r√©sultat (Best quality)",
                    "Photorealistic",
                    "Texture HD",
                    "Sharp focus",
                    "D√©tails intriqu√©s (Intricate details)",
                    "≈íuvre gagnante (Award winning art)",
                    "√âclairage de studio (Studio lighting)",
                    "Professionnel",
                    "R√©solution extr√™me"
                ]
            },
            {
                title: "RENDUS / MOTEURS 3D",
                id: "menu_render",
                options: [
                    "Octane Render",
                    "Unreal Engine 5",
                    "Redshift",
                    "V-Ray",
                    "Blender Cycles",
                    "Ray Tracing",
                    "Global Illumination",
                    "Ambient Occlusion",
                    "Subsurface Scattering (SSS)",
                    "Path Tracing",
                    "HDR (High Dynamic Range)",
                    "Physically Based Rendering (PBR)"
                ]
            },
            {
                title: "FORMAT DE SORTIE",
                id: "menu_format",
                options: [
                    "[ratio 16:9]",
                    "[ratio 1:1]",
                    "[ratio 21:9]",
                    "[ratio 9:16]",
                    "[ratio 4:3]",
                    "[ratio 3:2]",
                    "[ratio 2:1]",
                    "[ratio 32:9] (Ultra-cin√©mascope)"
                ]
            }
        ];

        const negativePromptBase = "text, watermark, signature, logo, copyright, username, artist name, bad anatomy, deformed, distorted, extra limbs, missing limbs, blurry, low quality, jpeg artifacts, cartoon, 3d render, smooth plastic skin, crop, worst quality, normal quality, lowres, skin spots, acnes, skin blemishes, age spot, glans, extra fingers, fewer fingers, strange fingers, bad hand, missing fingers, missing arms, poorly drawn hands, poorly drawn face, mutation, mutated, ugly, disgusting, poorly drawn, long neck, duplicate, morbid, mutilated, floating hands, disconnected limbs, malformed hands, blur, out of focus, long neck, long body, disgusting, childish, cartoon, 3d, illustration";

        // --- INITIALISATION ---
        window.onload = function() {
            const container = document.getElementById('menus-container');
            
            menusData.forEach(menu => {
                const block = document.createElement('div');
                block.className = 'menu-block';

                const label = document.createElement('label');
                label.className = 'menu-label';
                label.textContent = menu.title;
                
                const select = document.createElement('select');
                select.id = menu.id;
                
                // Option par d√©faut
                const defaultOption = document.createElement('option');
                defaultOption.value = "Choisir";
                defaultOption.textContent = "Choisir";
                select.appendChild(defaultOption);

                // Options du menu
                menu.options.forEach(optText => {
                    const option = document.createElement('option');
                    option.value = optText;
                    option.textContent = optText;
                    select.appendChild(option);
                });

                // Option Custom
                const customOption = document.createElement('option');
                customOption.value = "Custom";
                customOption.textContent = "Custom";
                select.appendChild(customOption);

                // Input Custom (cach√©)
                const customInput = document.createElement('input');
                customInput.type = "text";
                customInput.id = "custom_" + menu.id;
                customInput.className = "custom-input";
                customInput.placeholder = "Entrez votre texte...";

                // √âv√©nement pour afficher l'input Custom
                select.addEventListener('change', function() {
                    if(this.value === "Custom") {
                        customInput.style.display = "block";
                        customInput.focus();
                    } else {
                        customInput.style.display = "none";
                    }
                });

                block.appendChild(label);
                block.appendChild(select);
                block.appendChild(customInput);
                container.appendChild(block);
            });
            
            updateNegativePreview();
        };

                // --- FONCTIONS LOGIQUES ---

        
            function generatePrompt() {
            let parts = [];
    
            // --- INT√âGRATION DE L'ANALYSE IA ---
            const aiBase = document.getElementById('ai-base-content').value.trim();
            if (aiBase) {
                parts.push(aiBase); // On l'ajoute en t√™te de liste
            }
            // ----------------------------------------

            let weighted = document.getElementById('weight-toggle').checked;
            
            // --- GESTION AM√âLIOR√âE DU SEED ---
            const seedInput = document.getElementById('seed-input');
            let currentSeed = seedInput.value;

            // Si la case est vide, on g√©n√®re un seed al√©atoire (entre 1 et 999999999)
            // ET on l'affiche dans la case pour que l'utilisateur puisse le voir/copier
            if (!currentSeed) {
                currentSeed = Math.floor(Math.random() * 999999999) + 1;
                seedInput.value = currentSeed;
            }
            // ---------------------------------

            // Parcours de tous les menus
            menusData.forEach(menu => {
                const select = document.getElementById(menu.id);
                const val = select.value;
                let part = "";

                if (val === "Custom") {
                    const customInput = document.getElementById("custom_" + menu.id);
                    if (customInput.value.trim() !== "") {
                        part = customInput.value.trim();
                    }
                } else if (val !== "Choisir") {
                    part = val;
                }

                if (part) {
                    // Application de la pond√©ration si activ√©e
                    if (weighted) {
                        // On booste le sujet, le style et la qualit√©
                        if (menu.id === "menu_sujet" || menu.id === "menu_style" || menu.id === "menu_quality") {
                            part = `(${part}:1.2)`;
                        }
                    }
                    parts.push(part);
                }
            });

            const finalPrompt = parts.join(", ");
            document.getElementById('output-positive').value = finalPrompt;
            updateNegativePreview();
            return finalPrompt;
        }
        function updateNegativePreview() {
            let neg = negativePromptBase;
            
            // Gestion dynamique des conflits
            const styleSelect = document.getElementById('menu_style');
            const renderSelect = document.getElementById('menu_render');
            const styleVal = styleSelect ? styleSelect.value.toLowerCase() : "";
            const renderVal = renderSelect ? renderSelect.value.toLowerCase() : "";

            // Si style 3D ou Render 3D, on retire "3d render", "3d" du n√©gatif
            if (styleVal.includes("3d") || renderVal.includes("unreal") || renderVal.includes("octane") || renderVal.includes("cycles") || renderVal.includes("v-ray")) {
                neg = neg.replace(/, 3d render/g, "").replace(/, 3d/g, "").replace(/, cartoon/g, "");
            }
            
            // Si style Anime/Comics, on retire "cartoon"
            if (styleVal.includes("anime") || styleVal.includes("comics") || styleVal.includes("manga")) {
                neg = neg.replace(/, cartoon/g, "");
            }

            // Nettoyage des virgules doubles
            neg = neg.replace(/, ,/g, ",");

            document.getElementById('output-negative-preview').textContent = neg;
            return neg;
        }

        function getNegativePrompt() {
            // Force la mise √† jour avant de retourner
            return updateNegativePreview();
        }

        function surprisePrompt() {
            menusData.forEach(menu => {
                const select = document.getElementById(menu.id);
                const customInput = document.getElementById("custom_" + menu.id);
                const options = menu.options;
                
                // Choisir un index al√©atoire (excluant les 2 derni√®res options si besoin, mais ici on veut √©viter "Choisir" et "Custom")
                const randomIndex = Math.floor(Math.random() * options.length);
                
                select.value = options[randomIndex];
                
                // Cacher l'input custom au cas o√π
                customInput.style.display = "none";
                customInput.value = "";
            });
            generatePrompt();
        }

        function resetAll() {
            menusData.forEach(menu => {
                const select = document.getElementById(menu.id);
                const customInput = document.getElementById("custom_" + menu.id);
                select.value = "Choisir";
                customInput.style.display = "none";
                customInput.value = "";
            });
            document.getElementById('output-positive').value = "";
            document.getElementById('seed-input').value = ""; // On reset le seed
            document.getElementById('weight-toggle').checked = false;
            updateNegativePreview();
        }

        async function copyToClipboard() {
            const positive = generatePrompt();
            const negative = getNegativePrompt();
            const textToCopy = `${positive}\n\nNegative Prompt:\n${negative}`;
            
            try {
                await navigator.clipboard.writeText(textToCopy);
                showToast();
            } catch (err) {
                console.error('Erreur de copie : ', err);
                alert("Erreur lors de la copie automatique. Veuillez copier manuellement.");
            }
        }

        function exportTxt() {
            const positive = generatePrompt();
            const negative = getNegativePrompt();
            const seed = document.getElementById('seed-input').value || "Auto-Al√©atoire";
            
            let content = `--- GENERATEUR DIESERPUNK ---\n\n`;
            content += `[SEED]: ${seed}\n\n`;
            content += `[PROMPT POSITIF]:\n${positive}\n\n`;
            content += `[PROMPT NEGATIF]:\n${negative}\n\n`;
            content += `[DETAILS SELECTIONNES]:\n`;
            
            menusData.forEach(menu => {
                const val = document.getElementById(menu.id).value;
                if(val === "Custom") {
                    const cVal = document.getElementById("custom_" + menu.id).value;
                    content += `- ${menu.title}: ${cVal || "Vide"}\n`;
                } else if (val !== "Choisir") {
                    content += `- ${menu.title}: ${val}\n`;
                }
            });

            const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `dieselpunk_prompt_${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showToast() {
            const toast = document.getElementById("toast");
            toast.className = "show";
            setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 3000);
        }

        // Nouvelle fonction pour le bouton "D√©"
        function randomizeSeed() {
            const newSeed = Math.floor(Math.random() * 999999999) + 1;
            document.getElementById('seed-input').value = newSeed;
        }
</script>
<script>
    async function runInterrogation() {
        const hfInput = document.getElementById('hf-token-input');
        const fileInput = document.getElementById('image-input');
        const status = document.getElementById('status-area');
        const aiField = document.getElementById('ai-base-content');
        const btn = document.getElementById('btn-interrogate');

        const token = hfInput.value.trim();
        const file = fileInput.files[0];

        if (!token || !file) {
            alert("Token ou image manquante.");
            return;
        }

        try {
            btn.disabled = true;
            status.innerText = "Connexion via Proxy (Tunnel)...";

            const formData = new FormData();
            formData.append("inputs", file);

            // --- LE TRUC : ON UTILISE UN PROXY POUR PASSER LE MUR CORS ---
            const hfUrl = "https://api-inference.huggingface.co/models/Salesforce/blip-image-captioning-large";
            const proxyUrl = "https://corsproxy.io/?" + encodeURIComponent(hfUrl);
            // -------------------------------------------------------------

            const response = await fetch(proxyUrl, {
                method: "POST",
                headers: { 
                    "Authorization": "Bearer " + token 
                    // Pas de Content-Type pour FormData
                },
                body: formData
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error("Erreur API HF (via Proxy) : " + response.status + " - " + errorText);
            }

            const result = await response.json();

            let caption = "";
            if (Array.isArray(result) && result[0].generated_text) {
                caption = result[0].generated_text;
            } else if (result.generated_text) {
                caption = result.generated_text;
            } else {
                caption = "Erreur: Pas de texte g√©n√©r√©.";
            }

            if (caption && caption !== "Erreur: Pas de texte g√©n√©r√©.") {
                aiField.value = caption.toLowerCase().replace(/\.$/, "");
                status.innerText = "Termin√© avec succ√®s !";
            } else {
                aiField.value = "";
                status.innerText = "L'IA n'a rien trouv√©.";
            }

        } catch (err) {
            console.error(err);
            status.innerText = "Erreur : " + err.message;
        } finally {
            btn.disabled = false;
        }
    }
</script>
</body>
</html>






















